{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/fundamental-of-flutter-widget/",
    "result": {"data":{"cur":{"id":"046ab165-f7ab-5189-ae06-b420507f5eb2","html":"<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#step-21-statelesswidget-vs-statefulwiget\">STEP 2.1 StatelessWidget vs StatefulWiget</a></p>\n<ul>\n<li><a href=\"#step-22-stateless-widget\">STEP 2.2 Stateless Widget</a></li>\n<li><a href=\"#step-22-statefulwidget\">STEP 2.2 StatefulWidget</a></li>\n<li><a href=\"#step-221-state%EB%9E%80\">STEP 2.2.1 State란?</a></li>\n<li><a href=\"#step-23-statelesswidget%EA%B3%BC-statefulwidget-%EC%84%A0%ED%83%9D-%EB%B0%A9%EB%B2%95\">STEP 2.3 StatelessWidget과 StatefulWidget 선택 방법</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<ul>\n<li>STEP 1. 서론</li>\n<li>STEP 2. 본론\n<ul>\n<li>STEP 2. StatelessWidget vs StatefulWiget\n<ul>\n<li>STEP 2.1 StatelessWidget vs StatefulWiget</li>\n<li>STEP 2.2 Stateless Widget</li>\n<li>STEP 2.3 Stateful Widget\n<ul>\n<li>STEP 2.3.1 State란?</li>\n</ul>\n</li>\n<li>STEP 2.3 StatelessWidget과 StatefulWidget 선택 방법</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>STEP 3. 결론</li>\n<li>STEP 4. Reference</li>\n</ul>\n<h1 id=\"flutter---widget-state-buildcontext-그리고-inheritedwidget-part-1\" style=\"position:relative;\"><a href=\"#flutter---widget-state-buildcontext-%EA%B7%B8%EB%A6%AC%EA%B3%A0-inheritedwidget-part-1\" aria-label=\"flutter   widget state buildcontext 그리고 inheritedwidget part 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Flutter - Widget, State, BuildContext 그리고 InheritedWidget Part 1</h1>\n<h1 id=\"step-1-서론\" style=\"position:relative;\"><a href=\"#step-1-%EC%84%9C%EB%A1%A0\" aria-label=\"step 1 서론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1. 서론</h1>\n<p>Flutter 공식팀에서 Flutter에 대해서 소개하는 한 줄 코멘트가 있다.</p>\n<blockquote>\n<p>In Flutter, almost everything is a Widget.</p>\n</blockquote>\n<p>말 그대로 Flutter가 가장 강력한 이유라고 볼 수 있는 것이 심미적으로 아름다운 Material Design의 Widget들을 쉽고 빠르게 사용할 수 있으며, 추가적으로 이에 대한 속성 값을 변경하여 자유롭게 커스터마이징을 할 수 있게 해놨다는 점이다.</p>\n<p>우리는 단순하게 이게 어떠한 모양의 위젯이고, 어떤 속성을 갖고있으므로 어떠한 부분을 커스터마이징을 하기 위해서는 무엇을 바꾸면 된다. 정도만 해도 누구나 손 쉽게 어플리케이션 UI를 제작하는 시대가 왔다고 생각한다.</p>\n<p>하지만 계속해서 강의를 들으면서 쓸데없는 시간 낭비라고 혹자는 말할지는 모르겠지만, 궁금한 부분이 생겨났었고 오늘은 그 부분에 대해서 정리를 하고자 한다.</p>\n<h1 id=\"step-2-본론\" style=\"position:relative;\"><a href=\"#step-2-%EB%B3%B8%EB%A1%A0\" aria-label=\"step 2 본론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2. 본론</h1>\n<blockquote>\n<p>플러터에서는 거의 모든 것이 위젯이다.</p>\n</blockquote>\n<p>그렇다면, 우리가 만든 위젯은 어떠한 방식으로 렌더링이 되는 것일까?\n바로 위젯트리에 의해서 렌더링을 하게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyApp</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">StatelessWidget</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token metadata symbol\">@override</span>\n  <span class=\"token class-name\">Widget</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BuildContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">MaterialApp</span><span class=\"token punctuation\">(</span>\n      title<span class=\"token punctuation\">:</span> <span class=\"token string\">'Flutter Demo'</span><span class=\"token punctuation\">,</span>\n      theme<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ThemeData</span><span class=\"token punctuation\">(</span>\n        primarySwatch<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Colors</span><span class=\"token punctuation\">.</span>blue<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      home<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MyHomePage</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token string\">'Flutter Demo Home Page'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyHomePage</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">StatefulWidget</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">MyHomePage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token class-name\">Key</span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">:</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> title<span class=\"token punctuation\">;</span>\n\n  <span class=\"token metadata symbol\">@override</span>\n  _MyHomePageState <span class=\"token function\">createState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">_MyHomePageState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> _MyHomePageState <span class=\"token keyword\">extends</span> <span class=\"token class-name\">State</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyHomePage</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n  int _counter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">void</span> <span class=\"token function\">_incrementCounter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      _counter<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token metadata symbol\">@override</span>\n  <span class=\"token class-name\">Widget</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BuildContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Scaffold</span><span class=\"token punctuation\">(</span>\n      appBar<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AppBar</span><span class=\"token punctuation\">(</span>\n        title<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span>widget<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      body<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Center</span><span class=\"token punctuation\">(</span>\n        child<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Column</span><span class=\"token punctuation\">(</span>\n          mainAxisAlignment<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MainAxisAlignment</span><span class=\"token punctuation\">.</span>center<span class=\"token punctuation\">,</span>\n          children<span class=\"token punctuation\">:</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Widget</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span>\n            <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span>\n              <span class=\"token string\">'You have pushed the button this many times:'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span>\n              <span class=\"token string\">'$_counter'</span><span class=\"token punctuation\">,</span>\n              style<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Theme</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>textTheme<span class=\"token punctuation\">.</span>display1<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      floatingActionButton<span class=\"token punctuation\">:</span> <span class=\"token class-name\">FloatingActionButton</span><span class=\"token punctuation\">(</span>\n        onPressed<span class=\"token punctuation\">:</span> _incrementCounter<span class=\"token punctuation\">,</span>\n        tooltip<span class=\"token punctuation\">:</span> <span class=\"token string\">'Increment'</span><span class=\"token punctuation\">,</span>\n        child<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Icon</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Icons</span><span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// This trailing comma makes auto-formatting nicer for build methods.</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위의 소스코드는 Flutter 프로젝트를 생성하게 되면 처음 생기는 카운터 예제 어플리케이션이다.</p>\n<p>위에서부터 차근차근 살펴보겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyApp</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">StatelessWidget</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token metadata symbol\">@override</span>\n  <span class=\"token class-name\">Widget</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BuildContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">MaterialApp</span><span class=\"token punctuation\">(</span>\n      title<span class=\"token punctuation\">:</span> <span class=\"token string\">'Flutter Demo'</span><span class=\"token punctuation\">,</span>\n      theme<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ThemeData</span><span class=\"token punctuation\">(</span>\n        primarySwatch<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Colors</span><span class=\"token punctuation\">.</span>blue<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      home<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MyHomePage</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token string\">'Flutter Demo Home Page'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>우리 어플리케이션의 최상위 노드라고 볼 수 있는 <code class=\"language-text\">Myapp</code> 클래스이다.\n이 <code class=\"language-text\">Myapp</code> 클래스는 <code class=\"language-text\">StatelessWidget</code> 을 상속하여, <code class=\"language-text\">build()</code> 메소드를 오버라이딩해서 위젯을 렌더링하게 된다.</p>\n<p>이때 리턴 값으로 <code class=\"language-text\">MaterialApp()</code>  객체가 반환되는데 이 객체에 대한 설명은 나중에 하고, <code class=\"language-text\">home: MyHomePage(title: 'Flutter Demo Home Page')</code> 을 보자, 대충 이 객체가 무엇을 하는 놈인지는 모르겠지만, 웹 개발을 했던 사람이라면 <strong>home</strong>이라는 속성은 무엇인가 메인 페이지를 그릴 것 같다는 뉘앙스가 들 것이라고 생각한다.</p>\n<p>자 그럼 아래 클래스를 봐보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyHomePage</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">StatefulWidget</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>중략<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> _MyHomePageState <span class=\"token keyword\">extends</span> <span class=\"token class-name\">State</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyHomePage</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>중략<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n  <span class=\"token metadata symbol\">@override</span>\n  <span class=\"token class-name\">Widget</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BuildContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Scaffold</span><span class=\"token punctuation\">(</span>\n      appBar<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AppBar</span><span class=\"token punctuation\">(</span>\n        title<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span>widget<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      body<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Center</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>중략<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      floatingActionButton<span class=\"token punctuation\">:</span> <span class=\"token class-name\">FloatingActionButton</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>중략<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위의 코드를 보면 길게 보이겠지만 하나하나 뜯어보면 별 거 없다.\n아까전에 언급했듯이 <code class=\"language-text\">MaterialApp()</code> 의 프로퍼티 속성으로 정의된 이 부분에서  <code class=\"language-text\">home: MyHomePage(title: 'Flutter Demo Home Page')</code><br>\n<strong>MyHomePage</strong> 객체 부분이라고 보면 될 것이다.\n여기서도 <code class=\"language-text\">build(BuildContext context)</code> 부분만 보자면, 얘는 다시 <code class=\"language-text\">Scaffold()</code> 객체에 프로퍼티들을 정의한 후 리턴하는 놈이라고 볼 수 있을 것이다.</p>\n<p>대충 결과물에 대해서 그려보자면 이런식으로 그려진다고 볼 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 563px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 96.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACzElEQVQ4y8WSS0hUcRjFT5mZVjqjk49e9tLaVEQhvRdBuGhRZkVZYEFYkTpOGkqI9IQoeklpPqJJ24QW6Fgt2lVuCisIrVwE2tKY0bnv+x/vibFrKWnaqg/O/f6rH+fc8+H0/g08drOah04VMntnBvdmb+aeXRnMzs2yjlyuFOX5u1m2PqaMvIZU53QngDgADgAz7XckRs7RMg9THpBL60NMr1W5tEZlWo3C9Hrdml1HsfFCKysyI0vJ7Uh0RCUCmAtgAYAUAEsAzLZRU4a+Tbfy6PvczaYPX+nr6mVL50/5Onusps5e0fzUy6u7HcXi3nKkpcSEHcbamoOx5k2jh2SAFDJJk6RBWjppmZZFWXz76GNppuM8AKdzZmQ6gNUAVgJIs526bHg8gFl45fUwKAYYVGTqhklNN6jqBnXdtPpNVXR1+HhuR1wpeQELXdEuG5AMIMqOHX7Ps6GxeO31UBkcoKLKNE2ThmEMSRimFRSq+PLOx9ocV35xZgImNeMBTRv4+V0bL2e5TpO7sCo1LtYuIbxjAEwfVcgooDIWUBGfOtpYsSP+DICIJEdUONpCAIvtHTeuQ1VTGRIhCiFoCpMhISwppA1FrjmYVHgxOxnNJRnTwmBbw66mjgK2ez2URICBfj8lSfolWZKt73JAvH7RwJLtzorwIcfPilwEYBmAFbbLYc34ExjwU5EV9n3vY/9APxVJtvxaUHx538aqA4nuu7nz8Kx8Y8SkSxmOHP6PYY2MPAz05q+dNvmWlbFbHglsKPwX4F/u8H8Di8Y9bEmootsGVk8W2H7fQ8n0U5aCNDSduqYNydQ0y69JovNtK+8eSHLXHZ6PhoJ1EwNfNhZRMETB3zP4c1kPewZF+SMfW44nuJ8XJaOucM3EwDv7lrO1Ko+Pb7t5/1Iua87msPZsDp9UnrTqrxeIKye2snJTtPvWlmjc2DZnQuAPgWuXDW6If1kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Flutter-Start-Project\"\n        title=\"Flutter-Start-Project\"\n        src=\"/static/ae24fec18c68def8f1ce4f8eb44e0b04/7cb89/flutter-widget-structure.png\"\n        srcset=\"/static/ae24fec18c68def8f1ce4f8eb44e0b04/e9ff0/flutter-widget-structure.png 180w,\n/static/ae24fec18c68def8f1ce4f8eb44e0b04/f21e7/flutter-widget-structure.png 360w,\n/static/ae24fec18c68def8f1ce4f8eb44e0b04/7cb89/flutter-widget-structure.png 563w\"\n        sizes=\"(max-width: 563px) 100vw, 563px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이를 위젯 트리 형식으로 그려보자면</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFgElEQVRIx5VUa2xTZRh+z+mMQQMLIlEDygAFQxQW3I1u7bl2hQ26OcZtIE5wdF3Ppactu2HmGCgqkBBCJECMhojwA3AD1m1tT885bdeWzTFA5BIwkkz5QSQmQgLOkM985SImWxxf8iXnnPd8z/e+7/O8DwAA5FR9BQtqVTLfGYK8mq4ii6D9ahV1VFgX3ncVIXh+ViXkreuAMS9aCMHh3mFi5/GbUNYU713V1o9Wbu4frmxJIUYM2XmPBgt9BvlUgPuDt4mth2+AozEeX9XWh1a19d1f0XoaMUKwmHtawOxle8DsUskCZwjyawILrII2REkGLnmv8j1K//NUJeOVX2tAYZ1GmF0hKFE6x3NSz5tmtwHSMQS5aw/B/LXHxg5GuXugsOY4ZM5eDKUfXQBWUks4WfNanR0vsFIYODlCsB5j7IAW50ngvHGS98aAEVWJkaOIlmOIkfWLVmf7RMp1El9KjAmMVWJAi2E4eh2B88Bd4DzGhaot/ci5Y/D2ksYEMtf2LDe7IsDKuolTYv8PWFjTDkUbOsC+MWWy+VPAytp3JQ0J5GhOomJfDBU6A29Z6kJAiyETK2uAS89b+y3krvlmFMmIYaK4vp+khTDw3t4XGUnNsQqR/VZR0ygh/AGvxLLKP/uDeCm7CmdJlm8dgssIgXn90dEICQLnSwEnqZN4b+9UnC3tSYLFew4Y2QDbxr7xrByZvvIAwtmDvfEMUdpyGZbv/HMUQlyBN2hJC9CSfsnq7uEZOQq8L5lh8ydNVlcnWF2ds2lJT9GScZEWQhWcN44rISu/uDUKKbJ+vqQ+gRY3JhCvRO+Ya068UlgbAEfrFaLtLM5K71tUn0ClDQnEeYy7Flcgy+IKAC0ER2adVwxUvW3gb+eOwXt2fxyZnYGcQlcoHXtn5b7nWE/0Bma9etvAPV6JIas7mG91B3HvyVFIUT+l5SiipChiJK1z+uszieySjZhNE++NAyOpjbRkILwZWXvMRJHzxMgll7b+AqwU5jlZXWquPvgsIwaBEUNEQfUhmMk1weKWS8B7Ilbeo69+eW4FWbShHai6AGGpPTUyYOX2W8BIaeGmfZFydxPYfWz1A8ApcYKRNODcHRNYKTQHD4G96Xy6dzMY38iABdVHgJE1kvXoJjyC1rouoOq6gJE0El9ECUEHLek3adn4ixbVluKGQShuOEuMKux5FbtgbsUumLd0d/odj5f5w2NgmuaAaWzrM5xiXH13UwqVNSeRzRtFFlf320WubuyhJP730X68HnyIwhPBdH8K1rc/VEH02orWPrR6Sz+y+2JYBXPSoygEMSCRPuON/wucu+brtAQYUSXxLD8BnMn7eifToipQov47JerDtBTZw3n0qZw3/gIjRdJgvLf30XkT9gVY2HgmTQIjhsHmT43jlNirnBKbxSmx6ZwSm4TNwO7pmWxTtPmsNwm8NzGBU2LTOCU2m1NiWTZfb2bO+i4ocAbBewgBlDQPAiMEc1g5Us1IkVk2XzKTlfUMrEFaVGFR4wCWUT4rR5Zt+QFhktJZZb93FIr9iUyrW51irg1X5dV029pOIsDCbWA9UYRNlZW1g2Wbr8GcJdtwXzNsD4Ttw7GH8cNXEILyT4YIR/Np0tHcB8WK1uBoSiC8eUU7ArSk3y/flELLPj49jIFpd/d8RlQfGMf7B8bRkvHbf+JCKA9nOWXhXshbd3wir0RvSbvPIf+X54exJ2C9/YwfHE0pxHqMYcp16jXK3Q1lW64T+xGO6wPYcJc8itd1zbC6uiB+B0GW/fMMzmP8VLN9EOHNK9H7uD/ZtKgOUkL4BiOpy4v9CbD5kwRmjpUjwIjBeZSonqEENR231/eBzZckOVkjeSWKz+dycuRHTo4MMWK48h8Xfbw9CK8c9gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Flutter-Start-Project WidgetTree\"\n        title=\"Flutter-Start-Project WidgetTree\"\n        src=\"/static/80fa4c038d0d612443dbf6a3f5184b32/e17e5/flutter-widget-tree-structure.png\"\n        srcset=\"/static/80fa4c038d0d612443dbf6a3f5184b32/e9ff0/flutter-widget-tree-structure.png 180w,\n/static/80fa4c038d0d612443dbf6a3f5184b32/f21e7/flutter-widget-tree-structure.png 360w,\n/static/80fa4c038d0d612443dbf6a3f5184b32/e17e5/flutter-widget-tree-structure.png 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이러한 형식으로 그려질 것이다.</p>\n<p>자 이제 좀 더 깊게 들어가보자, 그렇다면 우리가 위젯을 렌더링할 때 사용하는\n<code class=\"language-text\">Widget build(BuildContext context)</code>의 <strong>빌드컨텍스트</strong>는 무엇일까?</p>\n<p>빌드컨텍스트(BuildContext)는 <strong>빌드 된 모든 위젯 트릭 구조 내의 위젯 위치에 대한 참조</strong>이다. 즉, <strong>트리의 부모자식 관계를 구성하기 위한 변수</strong>라고 볼 수 있다.</p>\n<p>현재까지 내용을 정리하자면</p>\n<ul>\n<li><strong>위젯트리</strong> : <strong>Flutter에서 위젯 렌더링을 위해 위젯의 부모자식관계를 표현하는 것</strong></li>\n<li><strong>빌드컨텍스트</strong> : <strong>빌드된 위젯 트리 구조 내에 위젯 위치에 대한 참조값</strong></li>\n</ul>\n<p>이라고 볼 수 있다.</p>\n<p>그렇다면 위의 예제코드에서 <code class=\"language-text\">class MyApp extends StatelessWidget</code> 와 <code class=\"language-text\">class MyHomePage extends StatefulWidget</code> 에서의 <code class=\"language-text\">StatelessWidget</code> 와 <code class=\"language-text\">StatefulWidget</code> 는 무엇을 나타내는 것일까?</p>\n<h2 id=\"step-21-statelesswidget-vs-statefulwiget\" style=\"position:relative;\"><a href=\"#step-21-statelesswidget-vs-statefulwiget\" aria-label=\"step 21 statelesswidget vs statefulwiget permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2.1 StatelessWidget vs StatefulWiget</h2>\n<p>Flutter에서 제공하는 위젯들은 크게 타입이 2가지로 나뉘어지게 된다.</p>\n<ol>\n<li><strong>StatefulWidget</strong></li>\n<li><strong>StatelessWidget</strong></li>\n</ol>\n<p>이름에서도 뭔가 느낌이 오지않는가? Stateful Wiget은 상태 값(state)이 변화하는 위젯이라고 볼 수 있으며, Stateless Widget은 상태 값이 변화하지 않는 위젯이라고 볼 수 있다.</p>\n<h3 id=\"step-22-stateless-widget\" style=\"position:relative;\"><a href=\"#step-22-stateless-widget\" aria-label=\"step 22 stateless widget permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2.2 Stateless Widget</h3>\n<p>이 위젯은 빌드 타이밍에 부모로 부터 받은 정보에 의존하는 컴포넌트이다.</p>\n<p><strong>즉, 한 번 빌드되면 신경쓰지 않아도 된다는 말입니다.</strong></p>\n<p>예시로는 Text(), Container(), Column() 등이 있다. 이러한 위젯들은 빌드할 때 파라미터를 단순히 전달한다. 이러한 파라미터를 전달해 한번 적용되면 <strong>다시 빌드를 하기 전까지는 변하지가 않는 위젯</strong>이다.</p>\n<p>다시 위의 예제 코드를 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">runApp</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyApp</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">StatelessWidget</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token metadata symbol\">@override</span>\n  <span class=\"token class-name\">Widget</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BuildContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">MaterialApp</span><span class=\"token punctuation\">(</span>\n      title<span class=\"token punctuation\">:</span> <span class=\"token string\">'Flutter Demo'</span><span class=\"token punctuation\">,</span>\n      theme<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ThemeData</span><span class=\"token punctuation\">(</span>\n        primarySwatch<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Colors</span><span class=\"token punctuation\">.</span>blue<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      home<span class=\"token punctuation\">:</span> <span class=\"token class-name\">MyHomePage</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token string\">'Flutter Demo Home Page'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>우리가 실행시킬 <strong>Main UI</strong>가 담긴 <code class=\"language-text\">MyApp</code> 클래스가 <strong>StatelessWidget</strong>이라고 볼 수 있다. 이 StatelessWidget의 라이플 사이클은 매우 단순하다.  <code class=\"language-text\">build()</code> 메소드를 오버라이딩하여, 초기화를 수행한다.</p>\n<h3 id=\"step-22-statefulwidget\" style=\"position:relative;\"><a href=\"#step-22-statefulwidget\" aria-label=\"step 22 statefulwidget permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2.2 StatefulWidget</h3>\n<p>StatefulWidget과 같은 경우에는 위젯이 살아있는 경우, 내부 데이터를 다루는 위젯이다. 따라서 <strong>데이터는 위젯이 살아 있는 동안 동적으로 변한다.</strong></p>\n<p>이게 바로 StatelessWidget과 StatefulWidget의 가장 큰 차이점이라고 볼 수 있다.\n이러한 <strong>동적으로 변화하는 데이터의 집합</strong>을 <strong>State</strong>라 부른다.</p>\n<p>즉, StatefulWidget과 StatelessWidget의 가장 큰 차이점은 내부에 <strong>State</strong>를 갖고있는가? 없는가?로 볼 수 있다.</p>\n<p>StatefulWidget과 같은 경우에는 내부에 State를 갖고 잇으며, 예로는 Silder(), CheckBox() 등이 있다.</p>\n<p>아래 코드가 StatefulWidget의 예시이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dart\"><pre class=\"language-dart\"><code class=\"language-dart\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyHomePage</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">StatefulWidget</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token metadata symbol\">@override</span>\n_MyHomePageState <span class=\"token function\">createState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">_MyHomePageState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> _MyHomePageState <span class=\"token keyword\">extends</span> <span class=\"token class-name\">State</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyHomePage</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>중략<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n  <span class=\"token metadata symbol\">@override</span>\n  <span class=\"token class-name\">Widget</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BuildContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Scaffold</span><span class=\"token punctuation\">(</span>\n      appBar<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AppBar</span><span class=\"token punctuation\">(</span>\n        title<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span>widget<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      body<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Center</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>중략<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      floatingActionButton<span class=\"token punctuation\">:</span> <span class=\"token class-name\">FloatingActionButton</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>중략<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>StatelessWidget과 조금 다른 점은, 클래스가 StatefulWidget과 State위젯으로 나뉘어진다는 점이다. 이 부분은 나 또한 궁금해서 찾아봤는데, 성능차이 때문에 분할했다는 내용을 많이 보았다. (틀렸으면 지적부탁드립니다.)</p>\n<p>그렇다면 StatefulWidget의 라이프사이클은 어떻게 될까?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 141.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAcABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwAEAf/EABcBAQEBAQAAAAAAAAAAAAAAAAABAwT/2gAMAwEAAhADEAAAAdIaQ15dVVCOsDslH//EABwQAAICAgMAAAAAAAAAAAAAAAECABEDExIhMf/aAAgBAQABBQJx0lsYw5BFNzWgGMITqSHxVqXP/8QAFhEAAwAAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/AXD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAcEAACAgIDAAAAAAAAAAAAAAABEQAQEjEhgaH/2gAIAQEABj8CbMWXtcFTa6pwiarZr//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESExQYEQYfD/2gAIAQEAAT8hyCVGroiskY4kwRaBhltTWRnwqITuLjqr1Pow2z1LK3Y5gp//2gAMAwEAAgADAAAAEOwZM//EABURAQEAAAAAAAAAAAAAAAAAABBB/9oACAEDAQE/ECj/xAAWEQADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8QdP/EABwQAQEBAAIDAQAAAAAAAAAAAAERACFRMUFxkf/aAAgBAQABPxBqBbhZ9yIFTbuECrCV8uQ91UGnUzgzuig+esoPk/dBWCrUk50+W2HSZ3l23+9yUlRTyaWqERUyLz763//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"StatefulWidget lifeCycle\"\n        title=\"StatefulWidget lifeCycle\"\n        src=\"/static/ef5378ba6ff5eabea8bd4f3b2f7c95d8/80e3c/stateful-widget-lifecycle.jpg\"\n        srcset=\"/static/ef5378ba6ff5eabea8bd4f3b2f7c95d8/4ec73/stateful-widget-lifecycle.jpg 180w,\n/static/ef5378ba6ff5eabea8bd4f3b2f7c95d8/158ba/stateful-widget-lifecycle.jpg 360w,\n/static/ef5378ba6ff5eabea8bd4f3b2f7c95d8/80e3c/stateful-widget-lifecycle.jpg 720w,\n/static/ef5378ba6ff5eabea8bd4f3b2f7c95d8/47311/stateful-widget-lifecycle.jpg 1080w,\n/static/ef5378ba6ff5eabea8bd4f3b2f7c95d8/d165a/stateful-widget-lifecycle.jpg 1400w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol>\n<li><strong>createState()</strong></li>\n</ol>\n<ul>\n<li>Flutter가 StatefulWidget을 만들 경우 즉시 실행</li>\n</ul>\n<ol start=\"2\">\n<li><strong>mounted is true</strong></li>\n</ol>\n<ul>\n<li><code class=\"language-text\">createState()</code>가 호출되면 <code class=\"language-text\">buildContext</code>가 state에 할당됌.\n<ul>\n<li><code class=\"language-text\">this.mounted = true</code> : buildContext가 state에 할당완료</li>\n<li><code class=\"language-text\">this.mounted = false</code> : buildContext가 state에 할당실패</li>\n</ul>\n-> false일 경우 <code class=\"language-text\">setState()</code> 호출 시 에러 발생 가능성 존재</li>\n</ul>\n<ol start=\"3\">\n<li><strong>initState()</strong></li>\n</ol>\n<ul>\n<li>위젯 인스턴스를 만들기 위해 <strong>BuildContext</strong>를 이용해 데이터 초기화</li>\n</ul>\n<ol start=\"4\">\n<li><strong>didChangeDependencies()</strong></li>\n</ol>\n<ul>\n<li><code class=\"language-text\">initState()</code> 호출 이후 실행 의존하는 객체가 호출될 때마다 호출</li>\n</ul>\n<ol start=\"5\">\n<li><strong>build()</strong></li>\n</ol>\n<ul>\n<li>위젯을 리턴</li>\n<li><code class=\"language-text\">setState()</code> 호출될 때마다 호출된다.</li>\n</ul>\n<ol start=\"6\">\n<li><strong>didUpdateWidget(Widget oldWidget)</strong></li>\n</ol>\n<ul>\n<li>부모 위젯이 업데이트 되거나 이 위젯을 다시 만들 경우 호출</li>\n</ul>\n<ol start=\"7\">\n<li><strong>deactivate()</strong></li>\n</ol>\n<ul>\n<li>해당 widget이 트리에서 제거되는 순간 호출</li>\n</ul>\n<ol start=\"8\">\n<li><strong>dispose()</strong></li>\n</ol>\n<ul>\n<li>모든 렌더링이 완전히 끝난 후, 자원 해제를 위해 호출</li>\n</ul>\n<ol start=\"9\">\n<li><strong>mounted is false</strong></li>\n</ol>\n<p>자세한 내용은 <a href=\"https://nhancv.com/newbie-chapter-4-widgets-state/\">Newbie Chapter 4. Widget’s state - nhancv’s blog</a>을 참고해보도록 하자.\n라이플 사이클만 봐도 Stateful Widget은 State가 관리되는 것이 핵심이라고도 볼 수 있어보인다. 그렇다면? State는 정확히 무슨 일을 할까?</p>\n<h3 id=\"step-221-state란\" style=\"position:relative;\"><a href=\"#step-221-state%EB%9E%80\" aria-label=\"step 221 state란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2.2.1 State란?</h3>\n<p>위에서 설명한 대로 State의 정의는 <strong>동적으로 변화하는 데이터의 집합</strong>이고, 이걸 프로그래밍적으로 보자면 , <strong>StatefulWidget 인스턴스의 “행동”을 정의하는 부분</strong>이라고 볼 수 있다.</p>\n<p>그렇기에, <strong>State는 위젯의 동작과 레이아웃을 위한 정보</strong>를 가지고 있으며, <strong>State가 변경되면 위젯은 리빌드</strong>가 된다.</p>\n<p>나름 중요하다고 생각하는 부분은 위에 Stateful Widget 라이프 사이클에서 2번 부분을  참고하면, <code class=\"language-text\">createState()</code> 이후에 <code class=\"language-text\">BuildContext</code>가 <strong>State</strong>에  할당되는 부분이다.  이때, State와 해당 BuildContext 사이에는 영구적인 연관관계가 생기며, State가 BuildContext를 절대 변경할 수 없게 만든다.</p>\n<p>만약, 해당 BuildContext가 다른 트리 구조로 이동되는 것이 가능하다고 해도, State는 한번 mount된 BuildContext와 연결을 유지하게 된다.</p>\n<p>이는 즉, <strong>State가 mount된 BuildContext가 아닌 다른 BuildContext에 접근가능하지 않게끔 하려는 의도</strong>로 보인다.</p>\n<h3 id=\"step-23-statelesswidget과-statefulwidget-선택-방법\" style=\"position:relative;\"><a href=\"#step-23-statelesswidget%EA%B3%BC-statefulwidget-%EC%84%A0%ED%83%9D-%EB%B0%A9%EB%B2%95\" aria-label=\"step 23 statelesswidget과 statefulwidget 선택 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2.3 StatelessWidget과 StatefulWidget 선택 방법</h3>\n<p>위에서 좀 깊게 StatelessWidget과 StatefulWidget을 다뤄봤다. 따라서 이 글을 보신 분들이라면 스스로 아래의 질문을 할 수가 있을 것이다.</p>\n<blockquote>\n<p>내 위젯이 라이플사이클 동안 변경될 변수를 고려해야 하며, 변경 시 위젯이 강제로 재구성이 될 수 있는가?</p>\n</blockquote>\n<p>스스로에게 질문을 해보고 내가 사용할 위젯이 해당 사항이 있다면, StatefulWiget으로 구성하면 되는 것이고, 아니라면 StatelessWidget으로 선택하면 된다.</p>\n<p>위의 질문에 구체적으로 안떠올린다 하면 아래의 예시와 자신이 만들 위젯과 비교해보자.</p>\n<p><strong>1. 체크박스를 보여줘야하는 위젯이 있다.</strong></p>\n<p>체크박스의 리스트는 배열로 구성되어 있고, 배열의 원소들은 각각 객체이며 그 객체들은 제목과 상태를갖는다.\n그리고, 당신이 클릭을 했을 때 배열의 원소의 상태 값이 변화한다.</p>\n<p>-> 이 경우에는 <strong>StatefulWidget</strong>을 사용하는 것이 좋다. 왜 일까?</p>\n<p>바로, <strong>배열의 원소들의 상태 값을 기억하여 체크박스를 다시 그리게끔 해야되기 때문이다.</strong></p>\n<p><strong>2. 회원가입을 하는 폼이 있다고 가정해보자.</strong></p>\n<p>이 폼은 유저에게 입력을 받아서 서버에 데이터를 전달하는 용도이다. 폼 검증은 서버 단에서 처리한다고 가정한다.</p>\n<p>-> 이 경우에는 <strong>StatelessWidget</strong>을 사용하는 것이 좋다. 왜 일까?</p>\n<p>바로, 폼을 검증하거나 제출하기 전에 <strong>어떠한 행동을 위젯에서 처리할 것이 없기 때문이다.</strong></p>\n<h1 id=\"step-3-결론\" style=\"position:relative;\"><a href=\"#step-3-%EA%B2%B0%EB%A1%A0\" aria-label=\"step 3 결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 3. 결론</h1>\n<p>지금까지 우리는 StatefulWidget과 StatelessWidget에 관해서 심층적으로 분석을 해봤다.</p>\n<p>다음에는 좀 더 깊이 들어가서 InheritedWidget에 대한 개념을 다뤄보도록 하겠다.</p>\n<h1 id=\"step-4-reference\" style=\"position:relative;\"><a href=\"#step-4-reference\" aria-label=\"step 4 reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 4. REFERENCE</h1>\n<ol>\n<li>\n<p><a href=\"https://medium.com/flutter-community/widget-state-buildcontext-inheritedwidget-898d671b7956\">Widget — State — BuildContext — InheritedWidget - Flutter Community - Medium</a></p>\n</li>\n<li>\n<p><a href=\"https://paulaner80.tistory.com/entry/Widget-State-BuildContext-%EA%B7%B8%EB%A6%AC%EA%B3%A0-InheritedWidget\">paulaner80 :: Widget, State, BuildContext 그리고 InheritedWidget</a></p>\n</li>\n<li>\n<p><a href=\"https://jaceshim.github.io/2019/01/25/flutter-study-buildcontext-class/\">Flutter Buildcontext Class - JACE SHIM</a></p>\n</li>\n<li>\n<p><a href=\"https://javaexpert.tistory.com/974\">Flutter Stateful Widget Lifecycle</a></p>\n</li>\n<li>\n<p><a href=\"https://medium.com/@pks2974/flutter-%EA%B0%84%EB%8B%A8-%EC%A0%95%EB%A6%AC%ED%95%98%EA%B8%B0-9532e16aff57\">Flutter 간단 정리하기 - 박성룡 ( Andrew park ) - Medium</a></p>\n</li>\n</ol>","excerpt":"STEP 2.1 StatelessWidget vs StatefulWiget STEP 2.2 Stateless Widget STEP 2.2 StatefulWidget STEP 2.2.1 State란? STEP 2.3 StatelessWidget과 StatefulWidget 선택 방법 STEP 1. 서론 STEP 2. 본론 STEP 2. StatelessWidget vs StatefulWiget STEP 2.1 StatelessWidget vs StatefulWiget STEP 2.2 Stateless Widget STEP 2.3 Stateful Widget STEP 2.3.1 State란? STEP 2.3 StatelessWidget과 StatefulWidget 선택 방법 STEP 3. 결론 STEP 4. Reference Flutter - Widget, State, BuildContext 그리고 InheritedWidget Part 1 STEP 1. 서론 Flutter 공식팀에서 …","frontmatter":{"date":"April 28, 2020","title":"Flutter - Widget, State, BuildContext 그리고 InheritedWidget (Part 1)","categories":"개발","author":"개발한입","emoji":"💻"},"fields":{"slug":"/fundamental-of-flutter-widget/"}},"next":{"id":"782cdf08-b721-5fb0-995c-d7c56e001ce1","html":"<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#step-11-let-%ED%82%A4%EC%9B%8C%EB%93%9C\">STEP 1.1 let 키워드</a></p>\n</li>\n<li>\n<p><a href=\"#step-12-%ED%98%B8%EC%9D%B4%EC%8A%A4%ED%8C%85hoisting\">STEP 1.2 호이스팅(Hoisting)</a></p>\n</li>\n<li>\n<p><a href=\"#step-13-%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%8B%A4%ED%96%89%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8javascript-execution-context\">STEP 1.3 자바스크립트 실행컨텍스트(JavaScript Execution Context)</a></p>\n<ul>\n<li><a href=\"#step-131-%EC%83%9D%EC%84%B1-%EB%8B%A8%EA%B3%84creation-phase\">STEP 1.3.1 생성 단계(Creation Phase)</a></li>\n<li><a href=\"#step-132-%EC%8B%A4%ED%96%89-%EB%8B%A8%EA%B3%84execution-phase\">STEP 1.3.2 실행 단계(Execution Phase)</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<ul>\n<li>STEP 1. ES6 VS ES6 이전 자바스크립트\n<ul>\n<li>STEP 1.1 let 키워드</li>\n<li>STEP 1.2 호이스팅(Hoisting)</li>\n<li>STEP 1.3 자바스크립트 실행컨텍스트(JavaScript Execution Context)\n<ul>\n<li>STEP 1.3.1 생성 단계(Creation Phase)</li>\n<li>STEP 1.3.2 실행 단계(Execution Phase)</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>STEP 4. Review</li>\n<li>STEP 5. Reference</li>\n</ul>\n<h1 id=\"step-1-es6-vs-es6-이전-자바스크립트\" style=\"position:relative;\"><a href=\"#step-1-es6-vs-es6-%EC%9D%B4%EC%A0%84-%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8\" aria-label=\"step 1 es6 vs es6 이전 자바스크립트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1. ES6 vs ES6 이전 자바스크립트</h1>\n<p>기존의 ES6 이전의 자바스크립트에서는 블록단위의 스코프가 존재하지 않았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'global var'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> homevar <span class=\"token operator\">=</span> <span class=\"token string\">'homevar'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>C나 Java등 많은 프로그래밍언어를 했던 사람이라면, for문 안에서 돌아가는 i에 대해서\n이 코드를 동작하면 생각하는 결과로는 에러를 뿜을 것이라고 생각을 할 것이다.</p>\n<p>왜냐? for문 안에서만 사용될 i가 100번 돌고나서 메모리 상에서 사라질 것이라고 생각하기 때문이다.</p>\n<p>하지만, 결과는 우리가 예상한 것과 다르다.\n저 코드를 돌려보면, <strong>100</strong>이라는 값이 나오는 것을 확인할 수가 있다.\n어째서 그런 것일까?</p>\n<p>ES6 이전의 자바스크립트는 블록 레벨 스코프(Block-level scope)를 따르는 것이 아니라, 함수 레벨 스코프(Function-level scope)를 따랐기 때문이다.</p>\n<p>이 두개가 정확히 무엇일까?</p>\n<ol>\n<li>\n<p><strong>함수 레벨 스코프(Function-level scope)</strong>\n함수 내에서 선언된 변수는 함수 내에서만 유효, 함수 외부에서는 참조할 수 없다.\n즉, 함수 내부에서 선언한 변수는 <strong>지역 변수</strong>이며, 외부에서 선언한 변수는\n모두 <strong>전역 변수</strong>이다.</p>\n</li>\n<li>\n<p><strong>블록 레벨 스코프(Block-level scope)</strong>\n모든 코드 블록(함수, if문, for문, while 문, try/catch 문 등) 내에 선언된 변수는\n해당 코드 블록 내에서만 유효, 코드 블록 외부에서는 참조할 수 없다.\n즉, 코드 블록 내부에서 선언한 변수는 <strong>지역 변수</strong>이다.</p>\n</li>\n</ol>\n<p>또한 ES5까지 변수를 선언할 수 있는 유일한 방법은 <strong>var</strong> 키워드였다.\n이 키워드는 아래와 같은 특징이 있고, 타 언어 대비하여 주의를 기울이지 않으면 치명적인 문제를 야기할 수가 있는 것들이 있었다.</p>\n<p>대표적인 것이 위에서 말한 var 키워드로 생성한 변수는 <strong>함수 레벨 스코프</strong>을 따른 다는 것이다.</p>\n<p>그 외에는 아래와 같다.</p>\n<ul>\n<li>var 키워드 생략 허용\n<blockquote>\n<p>암묵적 전역 변수 양산할 가능성이 크다.</p>\n</blockquote>\n</li>\n<li>변수 중복 선언 허용\n<blockquote>\n<p>의도하지 않은 변수값의 변경이 일어날 가능성이 크다.</p>\n</blockquote>\n</li>\n<li>변수 호이스팅\n<blockquote>\n<p>변수를 선언하기 이전에 참조할 수 있다.</p>\n</blockquote>\n</li>\n</ul>\n<p>대부분의 문제는 <strong>전역 변수</strong>로 인해 발생한다.\n우리가 학부 1학년 C언어 수업을 들을 때도 배우듯이 전역 변수를 활용하면서 편한 장점도 있지만, 대부분의 경우에는 <strong>스파게티 코드</strong>를 양산한다는 문제점이 있다는 것을 알고 있다.</p>\n<p>ES5 까지의 자바스크립트는 이러한 문제를 안고 있었다.</p>\n<p>따라서 위의 코드는 <strong>함수 레벨 스코프</strong>를 따르는 var 키워드를 통해 생성된 변수 i가\nfor문을 통해서 100까지 증가되었고, 스코프가 블록이 아닌 함수이기 때문에 for문이 끝난 이후에도 i 값이 100으로 참조가 가능한 것이다.</p>\n<p>이러한 문제를 ES6에서는 어떻게 해결하였을까?</p>\n<h2 id=\"step-11-let-키워드\" style=\"position:relative;\"><a href=\"#step-11-let-%ED%82%A4%EC%9B%8C%EB%93%9C\" aria-label=\"step 11 let 키워드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1.1 let 키워드</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'global var'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> homevar <span class=\"token operator\">=</span> <span class=\"token string\">'homevar'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>여기서는 단순하게, <code class=\"language-text\">var i</code>를 <code class=\"language-text\">let i</code>로 바꾼 거밖에 없는 코드이다.\n결과 값은 어떻게 될까?</p>\n<p><code class=\"language-text\">ReferenceError: i is not defined</code> 우리가 C와 Java에서 사용했을 때와 같이 에러가 출력이 된다. 어떻게 된 일일까?</p>\n<p>엄청 단순하다. <code class=\"language-text\">let</code> 키워드의 역할은<strong>함수 레벨 스코프</strong>를 <strong>블록 레벨 스코프</strong>로 바꿔준 것이다.</p>\n<p>이것을 제외하고도, let 키워드는 많은 장점이 있다.</p>\n<ol>\n<li>변수 중복 선언 금지</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> foo <span class=\"token operator\">=</span> <span class=\"token number\">123</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> foo <span class=\"token operator\">=</span> <span class=\"token number\">456</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> bar <span class=\"token operator\">=</span> <span class=\"token number\">123</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> bar <span class=\"token operator\">=</span> <span class=\"token number\">456</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 456이 찍힘</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>bar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// SyntaxError: Identifier 'bar' has already been declared</span></code></pre></div>\n<p>위에서 설명한 것과 같이 var 키워드는 동일한 이름을 갖는 변수를 중복 선언 가능하지만, <strong>let 키워드로는 동일한 이름을 갖는 변수를 중복해서 선언할 수가 없다.</strong></p>\n<p>이 후에는 호이스팅과 클로저가 있는데 이는 내용이 길 것같으므로, 따로 챕터를 나눠서 설명해보도록 하겠다.</p>\n<h2 id=\"step-12-호이스팅hoisting\" style=\"position:relative;\"><a href=\"#step-12-%ED%98%B8%EC%9D%B4%EC%8A%A4%ED%8C%85hoisting\" aria-label=\"step 12 호이스팅hoisting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1.2 호이스팅(Hoisting)</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ① undefined</span>\n<span class=\"token keyword\">var</span> foo <span class=\"token operator\">=</span> <span class=\"token number\">123</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ② 123</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> foo <span class=\"token operator\">=</span> <span class=\"token number\">456</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ③ 456</span></code></pre></div>\n<p>맨 위의 예시를 들었던 코드를 보면, 기존 C나 Java를 공부했던 사람들이라면, 에러가 뿜어질 것이라고 예상할 것이라고 필자가 예상한 바 중에 에러를 뿜는다는 부분이 있었다.\nfoo가 선언되기 이전 <code class=\"language-text\">console.log(foo);</code>을 보면 undefined라고 출력이 되는데,\n다른 언어와 달리 어째서 참조를 할 수 있으며, <strong>undefined</strong>라는 값을 뿜게 되는 것일까?</p>\n<p>이것은 자바스크립트의 특징 중에 하나로 <strong>모든 선언문은 호이스팅(Hoisting)되기 때문</strong>이다.</p>\n<p>호이스팅이란 var 선언문이나 function 선언문 등 모든 선언문이 해당 Scope의 선두로 옮겨진 것처럼 동작하는 특성을 말한다. <strong>즉, 자바스크립트의 모든 선언문(var, let, const, function, function*, class)이 선언되기 이전에 참조 가능하다.</strong></p>\n<p>자바스크립트의 변수 생성 및 호이스팅 과정을 알아 보자!\n자바 스크립트의 보다 자세한 내용은 Exeution Context을 보자, 변수 생성 및 호이스팅 과정은 아래와 같은 단계로 이뤄진다.</p>\n<ol>\n<li>\n<p>선언 단계(Declaration phase)</p>\n<blockquote>\n<p>변수 객체(Variable Object; VO)에 변수를 등록한다. (이 VO는 스코프가 참조하는 대상이 된다.)</p>\n</blockquote>\n</li>\n<li>\n<p>초기화 단계(Initialization phase)</p>\n<blockquote>\n<p>VO에 등로된 변수를 메모리에 할당한다. (이 단계에서 변수는 undefined로 초기화된다.)</p>\n</blockquote>\n</li>\n<li>\n<p>할당 단계(Assignment phase)</p>\n<blockquote>\n<p>undefined로 초기화된 변수에 실제 값을 할당한다.</p>\n</blockquote>\n</li>\n</ol>\n<p><strong>var 키워드로 선언된 변수는 선언 단계와 초기화 단계가 한번에 이루어진다.</strong>\n즉, 스코프에 변수가 등록되고, 메모리 할당 후에 undefined로 초기화가 되는 것이다.\n따라서, 위와 같이 선언문 이전에 변수에 접근하여도 VO에 변수가 존재하기 때문에 에러가 발생하지 않고, <strong>undefined를 반환</strong>하는 것이다.\n이러한 현상을 <strong>변수 호이스팅(Variable Hoisting)</strong> 이라 한다.</p>\n<p>다시 이를 통해 위의 코드를 분석해보면,\n①이 실행되기 이전에 <code class=\"language-text\">var foo = 123;</code>이 호이스팅 되어 ①구문 앞에 <code class=\"language-text\">var foo;</code>가 옮겨진다. 하지만, 변수 선언 단계와 초기화 단계가 할당 단계와 분리되어 진행되기 때문에, 이 단계에서 foo에는 <code class=\"language-text\">undefined</code>가 할당되어 있다.</p>\n<p>②에서는 변수에 값이 할당되었기 때문에 123이 출력된다.</p>\n<p>③이전에 말했듯이 var 키워드는 함수 레벨 스코프를 지니므로, 같은 이름의 변수를 재할당할 수가 있다. 그러므로 값이 456이 나오는 것이다.</p>\n<p>그렇다면? let 키워드의 경우에는 호이스팅이 어떻게 동작할까?</p>\n<p>var 키워드와 달리 let 키워드로 선언된 변수를 선언문 이전에 참조하면 참조 에러(ReferenceError)가 발생한다. 이는 let 키워드로 선언된 변수는 일시적 사각지대(Temporal Dead Zone; TDZ)에 빠지기 때문이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ReferenceError: foo is not defined</span>\n\n<span class=\"token keyword\">let</span> foo <span class=\"token operator\">=</span> <span class=\"token number\">123</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>let 키워드로 선언된 변수는 var 키워드와 달리 선언 단계와 초기화 단계가 분리되어 진행된다.</strong> 즉, 스코프에 변수를 등록하지만, 초기화 단계는 변수 선언문에 도달했을 때 이루어진다.</p>\n<p><strong>따라서, 초기화 이전에 변수에 접근하려하면 참조 에러(ReferenceError)가 발생한다.</strong> 상세히 말하면 변수를 위한 메모리 공간이 아직 확보되지 않았기 때문이다. 따라서 스코프의 시작부터 초기화 시작 지점까지는 변수를 참조할 수 없으며, 이 구간을 <strong>일시적 사각지대(TDZ)</strong> 라 부른다.</p>\n<blockquote>\n<p><strong>Temporal dead zone and errors with let</strong>\nIn ECMAScript 2015, let will hoist the variable to the top of the block. However, referencing the variable in the block before the variable declaration results in a ReferenceError. The variable is in a “temporal dead zone” from the start of the block until the declaration is processed.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 스코프 선두에서 선언 단계 실행</span>\n<span class=\"token comment\">// 아직 변수가 초기화 X</span>\n<span class=\"token comment\">// 따라서 참조 불가</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ReferenceError: foo is not defined</span>\n\n<span class=\"token keyword\">let</span> foo<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 초기화 수행</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// undefined</span>\n\nfoo <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 할당 수행</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1</span></code></pre></div>\n<p>이렇게 보면, ES6에서는 호이스팅이 발생하지 않는 것처럼 보인다. 하지만 그렇지가 않다. 아래의 예제를 참고해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> foo <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 전역 변수</span>\n\n<span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ReferenceError: foo is not defined</span>\n  <span class=\"token keyword\">let</span> foo <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 지역 변수</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위 예제의 경우 전역 변수 foo의 값이 출력될 것처럼 예상이 된다. 하지만, ES6 선언문도 호이스팅이 발생하기 때문에 참조 에러가 발생한다. 이 경우에는 지역 변수 foo도 해당 스코프에서 호이스팅이 되고, 일시적 사각지대에 빠진다. 따라서 전역 변수의 foo의 값이 아니라, 참조에러가 발생하는 것이다.</p>\n<p>클로저를 들어가기 앞서, 선행 지식으로 자바스크립트 실행 컨텍스트에 대한 이해가 필요하므로, 해당 내용을 먼저 정리해보도록 하겠다.</p>\n<h2 id=\"step-13-자바스크립트-실행컨텍스트javascript-execution-context\" style=\"position:relative;\"><a href=\"#step-13-%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%8B%A4%ED%96%89%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8javascript-execution-context\" aria-label=\"step 13 자바스크립트 실행컨텍스트javascript execution context permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1.3 자바스크립트 실행컨텍스트(JavaScript Execution Context)</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABu0lEQVQoz3WS32vTUBiG+88K3gre+B/owFtFmAyRiZM5R3WdbJXZUdNWcU7WdEnXZN3aJE2apuuaJjnNj0eaFi+GvvDxwsc5z3nPd06BlbJs6fZE8OnU4eh8xGHTzassu5R+O4xuQ8gSfN9nOBwydIa527aN67qkaUohW5HmcUKSJDiTEKk94vRyTOPC5afucaJ5SKqLc+PjzwK88Q2mYWKZFoOBjT2wcRwn319YwLYaFmt7Gi8rPZ7u62xU+7w7dVivm+w1TOpvzvi4JmGoI0SWINKE/ykHGl6IavlcuwEdJ6CpjTksdSh97lAp61S2Zb4VVTxvRpQk9LQRzeo16ncDpdZjdhutxpYtgXc16U959aBM8UmN3cc1Xj864utmk5g0TyftqDy7V2Lj4Ree399noI9XDwEFIQSREPztkP3jiGVfiDliHt9Zk5GkMVEkiKKIQpzETCczjt+eUX0v86Ok0igqSB9kDtZPuGyahGGA0TfodrsY/T66rnPVvcKf+oRBmIMWtQiXX1kEMcebMtWtFvVdldqOgrStcPDiF0bbzXNYpklLbqFrGm1VRTlXsCwr/zILd2wnn+Ef9vJL5asD8/EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"execution-context\"\n        title=\"execution-context\"\n        src=\"/static/dbcb12d0c45f0d76cf09c05259708198/37523/execution-context.png\"\n        srcset=\"/static/dbcb12d0c45f0d76cf09c05259708198/e9ff0/execution-context.png 180w,\n/static/dbcb12d0c45f0d76cf09c05259708198/f21e7/execution-context.png 360w,\n/static/dbcb12d0c45f0d76cf09c05259708198/37523/execution-context.png 720w,\n/static/dbcb12d0c45f0d76cf09c05259708198/302a4/execution-context.png 1080w,\n/static/dbcb12d0c45f0d76cf09c05259708198/07a9c/execution-context.png 1440w,\n/static/dbcb12d0c45f0d76cf09c05259708198/ce92a/execution-context.png 1459w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>실행 컨텍스트란 자바스크립트 코드가 실행되고 연산되는 범위를 나타내는 추상적인 개념이다.<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup></strong> 이게 무슨 말일까? <strong>실행 컨텍스트는 실행 가능한 코드가 실행되기 위해 필요한 환경</strong>이라고 이해하면 된다. 그렇다면? 실행 컨텍스트는 어떻게 만들어지고 변수와 함수는 어떤 스코프를 따르는지 이해가 필요하다.</p>\n<p>자바스크립트 엔진은 코드를 실행하기 위해 필요한 여러가지 정보를 알고 있어야 한다.\n여러가지 정보는 아래와 같은 것들이 존재한다.</p>\n<ul>\n<li>변수 : 전역변수, 지역변수, 매개변수, 객체의 프로퍼티</li>\n<li>함수 선언</li>\n<li>변수의 유효범위(Scope)</li>\n<li>this</li>\n</ul>\n<p>위와 같이 실행에 필요한 정보를 형상화하고, 구분하기 위해서 자바스크립트 엔진은 실행 컨텍스트(Execution Context)를 물리적 객체의 형태로 관리한다.</p>\n<p>실행 컨텍스트의 타입은 아래와 같다.</p>\n<ul>\n<li>\n<p><strong>전역 코드(Global Execution Context)</strong>\n가장 베이스가 되는 실행 구역이다. 특정 함수안에서 실행되는 코드가 아니라면, 코드는 전역 코드에서 실행된다. 전역 코드에서는 두가지 일이 이루어진다.</p>\n<ol>\n<li>window 오브젝트인 전역 컨텍스트 생성</li>\n<li>this를 global object로 할당</li>\n</ol>\n</li>\n<li>\n<p><strong>함수 코드(Functional Execution Context)</strong>\n함수가 호출될 때마다, 해당 함수에 대한 실행 컨텍스트가 생성된다.\n각각의 함수들은 자신만의 실행 컨텍스트를 갖지만, 이 컨텍스트는 <strong>함수가 호출이 되어야 만들어진다.</strong></p>\n</li>\n<li>\n<p><strong>Evel 코드(Eval Function Execution Context)</strong>\neval 함수 또한, 자신만의 실행 컨텍스트를 가진다. 하지만, 이번 포스트에서는 다루지는 않는다.</p>\n</li>\n</ul>\n<p>위에 대한 이해를 돕기 위해서 아래의 코드를 살펴보자!</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span> <span class=\"token string\">'xxx'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> <span class=\"token string\">'yyy'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> z <span class=\"token operator\">=</span> <span class=\"token string\">'zzz'</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">+</span> y <span class=\"token operator\">+</span> z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>위 코드를 실행하면, 아래와 같이 실행 컨텍스트 스택(Stack)이 생성하고 소멸한다.\n현재 실행 중인 컨텍스트에서 이 컨텍스트와 관련없는 코드(예를 들어 다른 함수)가 실행되면 새로운 컨텍스트가 생성된다. 이렇게 스택에 쌓이게 되면서 제어권이 이동된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABcSAAAXEgFnn9JSAAABaElEQVQY0y3QTU7CUBAH8N6BNXsTdl7AC3AGN1zAi7AXiJiYsIAIiLFQWgEpHw8oBfmMoS2F8vpeQSwbSCCmjnmEzST/zOSXmeGIbXvEtoESgvFq5XMoRWvHAYdSOBwOgQ5C4XQqBS/pNPRVNbRz3SDrXWYSNsZ+SsiJGcziWLExZgHvdjufOZ8jQ9Ngbhjgum6gpyjh92IRSqIIo8EgRAkJznUdDF2HhWkmvjcbP7Ht08XwuM167f1st2xDwufzVwLP9+LRKLxms5DNZG4mo9F9CyFQ2m2YjMd3+be323QyCU/xOJSKxWdRkq4dSn+ZsXacP+5TVb1quczOwQDg66sqEgUB2gjByrIChqaFW83mGVwuFiFtNgs2ZBlKkgTj4TBxPB793U7n9FEus+xxYqHgPcZiIAnCGfyaTlG1UoHhYMB+dAbrsgwMXZpmCFtWsKso0KjVQNe0xGG/9/O53OkhEoF6ter9A6g8QjsACvL7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Execution Context Stack\"\n        title=\"Execution Context Stack\"\n        src=\"/static/e913c89ccd104875b9e27d3cd15ac701/37523/ec_stack.png\"\n        srcset=\"/static/e913c89ccd104875b9e27d3cd15ac701/e9ff0/ec_stack.png 180w,\n/static/e913c89ccd104875b9e27d3cd15ac701/f21e7/ec_stack.png 360w,\n/static/e913c89ccd104875b9e27d3cd15ac701/37523/ec_stack.png 720w,\n/static/e913c89ccd104875b9e27d3cd15ac701/302a4/ec_stack.png 1080w,\n/static/e913c89ccd104875b9e27d3cd15ac701/07a9c/ec_stack.png 1440w,\n/static/e913c89ccd104875b9e27d3cd15ac701/e894c/ec_stack.png 1669w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ol>\n<li>자바스크립트 엔진이 실행 가능한 코드를 만나면, 논리적 스택 구조를 갖는 실행 컨텍스트 스택을 생성한다.</li>\n<li>전역 코드(Global code)로 진입하면 전역 실행 컨텍스트가 생성되고, 실행 컨텍스트 스택에 쌓인다. 전역 실행 컨텍스트는 어플리케이션이 종료될 때까지 유지된다.</li>\n<li>함수를 호출하면 해당 함수의 실행 컨텍스트가 생성되며, 직전에 실행된 코드의 실행 컨텍스트 위에 쌓인다.</li>\n<li>함수 실행이 끝나면, 해당 함수의 실행 컨텍스트를 파기하고, 직전의 실행 컨텍스트에 제어권을 넘긴다.</li>\n</ol>\n<p>이를 좀 더 개발자스럽게 살펴보면 아래와 같다.\n자바스크립트 엔진이 \u0003<code class=\"language-text\">script</code> 태그를 처음 만나면, 전역 실행 컨텍스트를 만들고, 현재 실행되고 있는 호출 스택에 이를 push한다. (그림의 맨 앞이라고 생각하면 된다.)\n그 후에 <code class=\"language-text\">foo();</code>와 <code class=\"language-text\">bar();</code> 함수가 연속으로 호출된다고 했을 경우 스택의 top에 함수 실행 컨텍스트를 push한다. (그림에서 2번째, 3번째)</p>\n<p>자바스크립트 엔진은 실행 컨텍스트가 호출 스택에서 가장 위에 있는 함수를 실행하고, 함수가 할 일을 끝내면 스택에서 제거(pop)한다. (그림의 4번째, 5번째)</p>\n<p>그렇다면 자바스크립트 엔진이 어떻게 실행 컨텍스트를 만드는 것일까?</p>\n<p>실행 컨텍스트는 2가지 단계로 생성된다. 1. 생성 단계(Creation Phase) 2. 실행 단계(Execution Phase)</p>\n<h3 id=\"step-131-생성-단계creation-phase\" style=\"position:relative;\"><a href=\"#step-131-%EC%83%9D%EC%84%B1-%EB%8B%A8%EA%B3%84creation-phase\" aria-label=\"step 131 생성 단계creation phase permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1.3.1 생성 단계(Creation Phase)</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJklEQVQ4y4WSe1PaQBTF+f6fQaed1qnWqa1/2lp8lWeQIBYqMJJAIIRHCAmvJCTLr5M4qPXVM3Pu3s2ee+fc7CaWyyWaptFqtVDVFrXaDbquo7XbtNttbm+bOM4U23ZQFAVVVWk0GnFNvV5HaSooSpN6vUGExHQ6JZVKkctmkSSJdCpFtVqN84vzc85OkowGfXpdjSv5krJcpCTLlMtXsVYuFpHyOWS5hBCCBG9gFa6xXYG1CJksRcyp/7p+vV6TiMKGT6FPPHbSOvv5HjvpLnu5Hns5nfHM33R4VpPYNArFGmcZxDRnPqNpRI+FF2DNfYbTu2/RWZRvtFFuzVfM3ODBYYToYF8yOCj0+ZTtsZvr8bkwoGK4fC2Z7OUNdjI6X6S7VVJsjq5Hse6gYHBY7OOtxMPIQqzx/BBvFbJYrLBtl5E2wFR1hqqOZc6ZOH7seO4GuH6IH4h7rkLxr8OXINw5s5GJZ1vRjqfKIBTP/2EUHMfGHFo0JJ16rksl06GS7VJJd2k3JjRKQyrpDte/NGp5nVqmg1IeEERmHl1q7DBqaPQN1KbGxW6V5LsyR9syyQ9ljrdKVM5aZA5uON6+4uR9mdOP1/zYKiF/b94/lcdTvjny//BSbeywoNgkqybnf0x+/h5xWjUpNG2+Ffpc1MacVEwOL/tM5qt4xDAU8SW+6DAKfdujbS7RLZeu5dIZuwwdn+ZggTHx0MZLbgcLvEC86mzT8C87jtEWsbZq9QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"execution-context\"\n        title=\"execution-context\"\n        src=\"/static/8dcc18dec436e13988a7af8b50697d7e/37523/lexical-scope.png\"\n        srcset=\"/static/8dcc18dec436e13988a7af8b50697d7e/e9ff0/lexical-scope.png 180w,\n/static/8dcc18dec436e13988a7af8b50697d7e/f21e7/lexical-scope.png 360w,\n/static/8dcc18dec436e13988a7af8b50697d7e/37523/lexical-scope.png 720w,\n/static/8dcc18dec436e13988a7af8b50697d7e/a1dd2/lexical-scope.png 838w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>생성 단계 동안 두 가지 일이 일어난다.</p>\n<ol>\n<li><strong>LexicalEnvironment</strong> 컴포넌트 생성</li>\n<li><strong>VariableEnvironment</strong> 컴포넌트 생성</li>\n</ol>\n<p>실행 컨텍스트는 개념적으로 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">ExecutionContext <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\nLexicalEnvironment <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ref<span class=\"token punctuation\">.</span> to LexicalEnvironment <span class=\"token keyword\">in</span> memory<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\nVariableEnvironment <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>ref <span class=\"token punctuation\">.</span> to VariableEnvironment <span class=\"token keyword\">in</span> memory<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>렉시컬 환경(Lexical Environment)</strong>\n렉시컬 환경은 identifier-variable와 매핑되는 곳이다.</p>\n<p>참조 대상 식별자인 identifier는 함수와 변수의 이름과 같이 어떤 대상을 다른 대상과 구분하여 식별할 수 있는 유일한 이름이다. 자바스크립트는 이 규칙대로 식별자를 찾는다.\n<strong>즉, 렉시컬 환경에서는 변수와 해당 변수에 대입된 값이 매핑되는 곳이라 볼 수 있다.</strong></p>\n<p>렉시컬 환경은 세가지 일을 한다. (VariableEnvironmnet도 동일)</p>\n<ol>\n<li>환경 레코드(Environment Record)</li>\n<li>외부 환경 참조(Reference to the outer environment)</li>\n<li>this 바인딩(this binding)</li>\n</ol>\n<p>렉시컬 환경은 식별자와 참조 혹은 값을 기록하는 <code class=\"language-text\">환경 레코드(Environment Record)</code>와 <code class=\"language-text\">outer</code>라는 또 다른 렉시컬 환경을 참조하는 포인터로 구성이 된다.\n<code class=\"language-text\">outer</code>는 외부 렉시컬 환경을 참조하는 포인터로, 중첩된 자바스크립트의 스코프 탐색을 위해 사용된다.</p>\n<p>보다 쉽게 이해하기 위하여, 아래의 코드가 렉시컬 환경으로 어떻게 구성되는지 보자!</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> c <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 2. Running execution context</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1. Call</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Running execution context의 LexicalEnvironment</span>\n<span class=\"token punctuation\">{</span>\n  environmentRecord<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    a<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    b<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    c<span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n    bar<span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span>Function<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  outer<span class=\"token operator\">:</span> foo<span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>Environment<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>아주 단순하게 나타낸 것이고, 실제로는 이보다 복잡하게 동작한다는 것을 알고 있으면 좋겠다. 아래에서는 보다 깊게 이해하기 위해서 렉시컬 환경에서 이루어지는 일들에 대해서 자세히 알아보도록한다.</p>\n<hr>\n<p><strong>1. 환경 레코드(Environment Records)</strong>\n렉시컬 환경 안에 함수와 변수를 기록한다.</p>\n<p>프로그래밍 언어를 보면, 변수나 함수에 이름을 부여하여 의미를 부여한다.\n<em><strong>이름이 없을 경우에는 변수나 함수는 그냥 단순한 하나의 메모리 주소에 불과하다.</strong></em> 따라서, 프로그램은 “이름:값”에 대응하는 대응표를 만들어 사용한다. 이 대응표를 활용하여, 프로그래머들이 함수나 변수의 명을 짓고, 보다 쉽게 코드를 이해할 수 있게끔 하는 것이다.</p>\n<p><strong>이와 같은 대응표가 환경레코드와 같다고 볼 수 있다.</strong></p>\n<p><strong>2. Reference to the outer environment (외부 환경 참조 = Scope Chain)</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACS0lEQVQoz11T227aQBDl/78lSfvSl6aVmgiHOMGAjQ3BKIANxje8vuK7faodShplpNF416MzM2fODvamCUmSsFgsIMszvL9vII3HGI/H0HUdfdcBfX+JX6zve3Sf7vl5wFgATdUwVxS8iCJ2hgF9tSJAwzCQ5zkc34freXh8fMRoNKKCwnCI3c4AYwxhFP0HLM8lsuyMOElRVxWqLEPHO+p7SvIcB8+3N7i/u8XDwwNc14HjurAsC57nIQgCOLaNsigofxB7MYLtCYa5RxwnqJIETdNQZzxywMWLiKkkfYCkJx9VVSHLMvKQMeS8y7bFoCgLVKwEOzIELESVpuiriipyfpIkwXqzxf6wx3Q6pS4lYQhN06iA67o4BQHltkV+AWzLBuzAsLeOCKMY5yDAOUlohDiKoEoSVEWGKIqYz+eYaypkWYZlHahj27bR1DW6ssSgLEt0fYetaWKzNbBYrvC+3X0Q7Tk2xLsb/Pj+DW+rFVHBOU+zMxUP4wSBf0LmeZeReUIUxZTEecnzArxImqYE6HseVFWFvl5juVxAURRobzrGkxkmMwXqm44Tp6rILx0GjNEyvhoHb9sWRVFgZ5q0Wc6hIAgYCgIE4Qk7w8TBsugfVwVx6Hk+on+A/Se5EBVdB/t4xOT3L/y5/0k6dBwHPtclX8bphDAMKRZJgr5pMOCCjeKYOuIgV+dy4OB8k/LzCJPXF3pRijLHemNgIqt4ncywXG/guD6NTDrkY3G98Xj165kb/y7rmmJd15eC/AHU9cWrmu6vk/0FHIOCCQ2yDLgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Scope-Chain\"\n        title=\"Scope-Chain\"\n        src=\"/static/6050e94af744b3a82d2dd6dbb11d861a/37523/scope-chain.png\"\n        srcset=\"/static/6050e94af744b3a82d2dd6dbb11d861a/e9ff0/scope-chain.png 180w,\n/static/6050e94af744b3a82d2dd6dbb11d861a/f21e7/scope-chain.png 360w,\n/static/6050e94af744b3a82d2dd6dbb11d861a/37523/scope-chain.png 720w,\n/static/6050e94af744b3a82d2dd6dbb11d861a/fe9f1/scope-chain.png 883w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>환경 레코드를 통하여 변수를 찾아보고, 없다면 바깥 환경을 참조하여 찾아보는 식으로 중첩 스코프가 가능해진다. 이 중첩 스코프 탐색은 해당하는 이름을 찾꺼나 바깥 렉시컬 환경 참조가 <code class=\"language-text\">null</code>이 될 때 탐색을 멈춘다.</p>\n<p><strong>즉, 외부 환경에서 해당 변수를 찾아 볼 수 있다</strong>는 의미이다.</p>\n<p>스코프 체인을 아는 사람을 알겠지만, 위의 방식은 스코프 체인과 동일하다.</p>\n<blockquote>\n<p>A <em>scope chain</em> is a <em>list of objects</em> that are searched for <em>identifiers</em> appear in the code of the context.</p>\n</blockquote>\n<p>스코프 체인도 ES6이전과 이후의 내부 구현 방식에 차이가 있다.</p>\n<p>아래의 코드를 참고해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token constant\">A</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">b</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token constant\">B</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">b</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 458px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAA7EAAAOxAGVKw4bAAADdElEQVQ4y62UW09jVRTH+0F88gNoMiaTeJlxjGNMxEAmvuknMD4bn+bJBxIvY5gBJpR6wUSUGRniFGwZO0xbejkX2kqvQNtzeqXTQoEUbAtt+Zm9CdUy8+CDK/lnrb3PXv+zbntbuCCnp6dStzptJoPfM/pkjDGflfHAd9zx27jlvcvnrq9xplbkud5pr+8jxHKR7Pzj/l8HXJu+wYtfXubK1DBDMx/x3g8fcunOdV4YfZmbjlF5rtvr9f0ELM+NrtVGD4WYXbrHL8vzzDyc5SfHPal/dtxnxj7LgvMhxULpLMreP1Fa/s1+vnl0dISuh1D8KkGfgs/jl/CvBvG6fSgBDY/bi6Kqz5TruYTNZpOtdIa1SJiAqhDUVPxKEEXXWA34pQ5FwsRicWq1GtVqVfo8U8OLqf9X6XQ6lEolCcvx8bFkb7VaEs1Wk85xh2K9jDP5GNeGR+IPCbe0nckVQrl12q023W5X+lUqFU5OTrAcHh7KsHd2diSe1qq0DprM6Qu8NP4WV6dHeGN6mFenhnhtaojXp97n0uR1Pr7/KY29BsVSSZL1m7K3t0c2myWXy5EzcximSd7ME1hXuGWfwLbyIxPLNiacNu4++lbqbxYnmPPMEwlFSKfTg00R7A6HA7fbLXU0GmVjY4NqpUoxW6Bslihk8hSyeUpGsY9KcZtEMsFevT4wOpZCoSDJfD4fHo9Hal3TKZfLrEfX0dZ09DUdVVPRQzqqrhH+M0IylZIBpFIpSda/KaJu8XhcfhBIJpMkEgli8ZhEPBEfQOwc8RiRSATDMGTtRR9Ecy38TyIyEuWztNttRKfF7RAQdrfdIVpM8MWTcW6vTkuMrVoZ81q57bXylXuS+Yidk9axHBkx2Pv7+2cpNxoNuXE+NpWnFQ7rDea0BV6ZfIe3bR9wzXaDK9ZhrlpHeNM6wuXJd/nk18+olatsbm3JIPpdrtfrxGIxUsmzGmYyGYyswXoyygP3bzzSH2P3O1j0O/g9uMxiwMmCx86K6kbXNLa3t/tdlhGK3JeWlnC5XDidTsLhsCSu79YpmkXy2Rxm2sRMG9LOZXIUjDy71V05v7VqbeDpk2Pj9XoJBAJyZIQdDAZlpKFwSI6LQFBRUDUNRVXkenNzE13Xyefzg4SimDJNw+hD/DmTHtwzTXNgLXzELTk4OBh4UP4G5e4/ZG1/hfoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Scope-Chain Example\"\n        title=\"Scope-Chain Example\"\n        src=\"/static/08ebd163b97c2d0a3250833d1f4f2b7d/f7a31/scope-chain2.png\"\n        srcset=\"/static/08ebd163b97c2d0a3250833d1f4f2b7d/e9ff0/scope-chain2.png 180w,\n/static/08ebd163b97c2d0a3250833d1f4f2b7d/f21e7/scope-chain2.png 360w,\n/static/08ebd163b97c2d0a3250833d1f4f2b7d/f7a31/scope-chain2.png 458w\"\n        sizes=\"(max-width: 458px) 100vw, 458px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>ES6 이후의 실행 컨텍스트(Execution Context; 이하, EC)가 가 생성되는 과정을 알아보자. 함수 <code class=\"language-text\">a()</code>가 실행되면, 위에서 설명했던 것과 마찬가지로 함수 EC의 타입에 해당하므로, EC가 생성이된다.</p>\n<p>렉시컬 환경은 생성시점의 a()의 정보를 갖고 생성이 된다.\n위의 코드를 보면, 함수 생성시점에 평가된 EC a(), EC b()와 Global이 생성되면서, <strong>outer Lexcial Environment</strong>에 의해서 연결이 된다.</p>\n<p>정리를 해보자!\n<strong>함수가 생성되면 실행 컨텍스트가 생성되고, 그리하여 렉시컬 환경의 내부 outer Lexical Environment가 상위 환경레코드와 연결이 됨으로써 내부 함수 정보 탐색이 가능하게 되는 것이다.</strong></p>\n<p>자세한 내용은 아래를 참고해보자.</p>\n<ul>\n<li><a href=\"http://dmitrysoshnikov.com/ecmascript/es5-chapter-3-2-lexical-environments-ecmascript-implementation/#lexical-environment\">ECMA-262-5 in detail. Chapter 3.2. Lexical environments: ECMAScript implementation. – Dmitry Soshnikov(ES6 이후)</a></li>\n<li><a href=\"http://dmitrysoshnikov.com/ecmascript/javascript-the-core/#scope-chain\">JavaScript Core - Scope Chain(ES6 이전)</a></li>\n<li><a href=\"https://poiemaweb.com/js-execution-context\">실행 컨텍스트와 자바스크립트의 동작원리 - PoiemaWeb</a></li>\n<li><a href=\"https://meetup.toast.com/posts/129\">자바스크립트 함수(3) - Lexical Environment : TOAST Meetup</a></li>\n</ul>\n<p><strong>3. This Binding(This 바인딩)</strong></p>\n<p><code class=\"language-text\">this</code>의 값이 여기서 결정된다.</p>\n<p>글로벌 실행 컨텍스트에서 <code class=\"language-text\">this</code>는 global object이다. 함수 실행 컨텍스트는 <code class=\"language-text\">this</code> 값은 어떻게 함수가 호출되었는지에 따라 달라진다. 만약, 함수가 object reference로 호출되었다면 <code class=\"language-text\">this</code> 는 해당 객체를 가리키게 된다. 그렇지 않으면 this는 글로벌 객체(window)를 가리키거나 <strong>strict mode</strong>에서는 <code class=\"language-text\">undefined</code>를 가리키고 있다.</p>\n<p>단순하게 설명하면, 초기에 this는 window를 가르키지만, new를 통하여 객체를 할당할 경우에 변경이 된다. (strict mode시에는 초기에 undefined를 가르킨다.)</p>\n<p>여기까지가 생성 단계(Creation Phase)의 내용이였다.</p>\n<p>간단히 정리를 해보자면, 생성 단계에서는 아래와 같은 일들이 벌어진다.</p>\n<ul>\n<li>Scope Chain, 변수, 함수, 인자들을 만든다.</li>\n<li>this 를 결정한다.</li>\n<li>자바스크립트 엔진의 Syntax Parser가 코드를 읽으면서 컴퓨터가 알아들을 수 있는 언어로 변환된다.</li>\n<li>자바스크립트 엔진은 코드를 읽으면서 변수와 함수의 선언된 것을 찾고 메모리에 해당 변수와 함수를 저장한다. (호이스팅)</li>\n</ul>\n<hr>\n<h3 id=\"step-132-실행-단계execution-phase\" style=\"position:relative;\"><a href=\"#step-132-%EC%8B%A4%ED%96%89-%EB%8B%A8%EA%B3%84execution-phase\" aria-label=\"step 132 실행 단계execution phase permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1.3.2 실행 단계(Execution Phase)</h3>\n<p>이제 코드를 통해서, 생성단계와 실행단계를 알아보도록 하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> c<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e<span class=\"token punctuation\">,</span> f</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> g <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> e <span class=\"token operator\">*</span> f <span class=\"token operator\">*</span> g<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nc <span class=\"token operator\">=</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPElEQVQoz4WSzXKDMAyEef+n6vRAk5QEY+vPJnmW7UhAhk5actiLNf60K6kTEQzXAeM4IqUUmqYJtVbc7/cXzfN8qI6ZA+LAKWfU2tBai+JfgHfgzp3knJFSRikMNYOqRtHMorbXf843dbU6oAfRJ3L5APMJsgId7PH38jf/aKJgYogZWqvRyJOFQ6IRzAlMI6oR6hp5A27u9kBlgY9LbYH9AuZCkCJQUYjoM/IR0FShIpBVqhZGOo9XSgZRARGBhV+AvqxpD3w8YCSglBcz7lRtceiD9y1fbyNyLvHort859CRUCsiji8J38Yzss3CYw2ursGoLUATT9xfGS4906ZGHE0wlgP5PTeMqbD21NntkkeiuxEtk5gDH2agE5HbuQ3k4x+wOz8a8k2pAvKNFR3searhet1jXRkeH/QMoyATr9ilu9QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"execution-context\"\n        title=\"execution-context\"\n        src=\"/static/ac0cdd415b657b6546220e5d00215953/37523/execution-phase1.png\"\n        srcset=\"/static/ac0cdd415b657b6546220e5d00215953/e9ff0/execution-phase1.png 180w,\n/static/ac0cdd415b657b6546220e5d00215953/f21e7/execution-phase1.png 360w,\n/static/ac0cdd415b657b6546220e5d00215953/37523/execution-phase1.png 720w,\n/static/ac0cdd415b657b6546220e5d00215953/774b6/execution-phase1.png 738w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>자바스크립트 엔진은 <code class=\"language-text\">script</code> 태그를 만났을 경우에 a, b, multiply()는 LexicalEnvironment에 등록을 하고, 변수 c는 variableEnvironment의 환경 레코드(이름:값)에 등록한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABO0lEQVQoz5WTa07EMAyEe/9jISQWaJsmju04LWcZZHfb1YpdED+miaLk8/jRgYgwjiPGacScZtRaUbmitYZt2x5qXdenGpoZcibMqSAXhtkKM8O6bei9Q0Tu5I+eBXINZg0sU0h1gmgCXx86YFkW5JxDvj+cezDrPVa/29d9DWDlN4i+o7ULzBLM+gl0UCkl5PsDKIVAVMHaIiOXwwffEDGkKoQbtFk8+guoVaCq0KZx5gqgtgZvDNcKZo6mOChc3AHzPZAYtHjdCbUyRPUKVI3apLSgEEW60ZSHDssNKAqpvLtUvaXsH4+QlnKNYmjWosvCjDx9oMyfp06gaowXsZx1PB16mhq297pEDR1YCenyguX99VRT/XUWA0gOFIkauo6mxEiV5SbK4eIAPpzD3n9GOWZqv/T1rz/lG65GBXThNa82AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"execution-context\"\n        title=\"execution-context\"\n        src=\"/static/d1810c752ac3c3fafd1194a5e8df5177/37523/execution-phase2.png\"\n        srcset=\"/static/d1810c752ac3c3fafd1194a5e8df5177/e9ff0/execution-phase2.png 180w,\n/static/d1810c752ac3c3fafd1194a5e8df5177/f21e7/execution-phase2.png 360w,\n/static/d1810c752ac3c3fafd1194a5e8df5177/37523/execution-phase2.png 720w,\n/static/d1810c752ac3c3fafd1194a5e8df5177/774b6/execution-phase2.png 738w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>전역 컨텍스트의 실행 단계에서 코드가 실행되고, 각각의 변수에 값이 할당된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtUlEQVQoz31T2W7cMBDb//+3PLR52CBIEbf1sTosS7Ju28tixps8FEEEEGMIEs0hRxdrLcZxhBCCMU0TlFJoreF+vzP+Xx/7X+HinMMwDOj7Hkpp5JxRa0WpBW1rOI6DyT+w7/v3hHRZSolhvGG8aaxrRCmFsW0bvPesnM5QXZblC6KDf8yEdMk6B2sdljXCxwSzWKwhoG07nLNMRDZIKWDmGWRCSxl+trAhcUcE4rqQEmp11pov6UddzMItkiVCSt4nlcYYJqwxY10cUi4oD4s+Cdd1RUoJMQb+jjHCe4daG1ajIN+vkN0LdPcCK4ZTYS7wykDPhm1YQ0QjwhAChJAMaz1a2x4BVGz7gXUWUG8/Id6eoX89w97+nISlwkkD6zxiiMglnwprLZDyhn6cIJVmlZQ0h7Lv8EZBd1csf18xd1dY0Z+EtcE7B+M8XCwsYtuJsBWEOML530hpQM4WpZwm78cBKycM1ydMrz8wXp+g+3cmpERpZruuY89pGijpS0wJQijMeubKASjF5pPKVguCNYhu4VpS/CSkR0HnajsT5rGhhEKM3CYh5cSVgiGVX63vXtA/nmJP2BdM3foAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"execution-context\"\n        title=\"execution-context\"\n        src=\"/static/1f4ef112f2f2653959dfd3464013d508/37523/execution-phase3.png\"\n        srcset=\"/static/1f4ef112f2f2653959dfd3464013d508/e9ff0/execution-phase3.png 180w,\n/static/1f4ef112f2f2653959dfd3464013d508/f21e7/execution-phase3.png 360w,\n/static/1f4ef112f2f2653959dfd3464013d508/37523/execution-phase3.png 720w,\n/static/1f4ef112f2f2653959dfd3464013d508/774b6/execution-phase3.png 738w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>multiply 함수가 호출되는 순간 multiply() 함수의 실행 컨텍스트가 생성된다. 외부 환경으로는 전역 컨텍스트를 참조하고 있고, object reference로 호출되지 않았기 때문에 해당 생성시점의 this는 window와 같은 글로벌 오브젝트이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvklEQVQoz3VTi46cMAzk/7+u7d1W7bW3L1gIhLx4hAAJU9mUba9SQcZokoztsZM55yCEQNM07Ou6ZlvXFfRs28b27/M/LDPGMIGUElpreO8xTROWZcGyLogxIqaIEMLTjmC05288pYSs6zoURYHrLUctDcK8YJ5nhDDzJiIchoGDUhXkKTAdVkp9wMdxRBbmGZSlNg7KjXCDh7UWfgpMTIR93z+rqJuGCQlv25bJGK9rDpzRhyIZrdH8PtRKCWcdl34Q0lorG/YHoWJCOnNkOCDzfuJUqTwiOPQ4/mNKGKxC8/6K5nxCez7B1gXjVgro6g4tcqjqjnHokVGXq6pE8XhAG8tCU6mHjzFhtArt+RXyfIK6nOAOwlbAiDtMXUCLOzwRTlMH43IoncN2JULwnDEZNYya1FvNGarbNyYlkpg2yPwd5dsXlD9e2IbO7l1WmjRsIeWuIWlK+K5hQm8Uyu+fIH6+oHr7DF3ekDbAVleWgNbU9St873YNqTHj6DH0wzM7P45c8hojUoyYw7Tb5LEuC8+htQblo4CoSjS14EZlKW3P28Dv9sdo1sgI/3gjdq+NweVyQZ4XPHo08L8ADvRKNVDZxTMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"execution-context\"\n        title=\"execution-context\"\n        src=\"/static/bdc5ce987669f26f425b7b06fac25f77/37523/execution-phase4.png\"\n        srcset=\"/static/bdc5ce987669f26f425b7b06fac25f77/e9ff0/execution-phase4.png 180w,\n/static/bdc5ce987669f26f425b7b06fac25f77/f21e7/execution-phase4.png 360w,\n/static/bdc5ce987669f26f425b7b06fac25f77/37523/execution-phase4.png 720w,\n/static/bdc5ce987669f26f425b7b06fac25f77/774b6/execution-phase4.png 738w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>multiply 함수가 값을 리턴하면서 호출 스택에서 pop된다.\n전역 컨텍스트에 있던 전역 변수 c에 결과 값이 업데이트가 되며, 그 후 글로벌 코드가 끝나면 프로그램도 종료된다.</p>\n<h1 id=\"review\" style=\"position:relative;\"><a href=\"#review\" aria-label=\"review permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Review</h1>\n<p>ES6와 ES5의 차이점을 이해하기 위해서 let이라는 키워드로 출발하여, 호이스팅과 실행컨텍스트에 대한 개념까지 다뤄봤다.</p>\n<p>원래는 클로저와 const 키워드까지 다루려고 하였는데 생각보다 양이 매우 많아져서 챕터를 나누기로 하였다. 자바스크립트 원리에 대해서는 다양하게 인터넷에 설명하고 있는 자료들이 많으니, 참고하기를 바란다.</p>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<ul>\n<li><a href=\"http://www.ecma-international.org/ecma-262/6.0/\">ECMAScript 2015 Language Specification</a></li>\n<li><a href=\"https://poiemaweb.com/es6-block-scope\">let, const - PoiemaWeb</a></li>\n<li><a href=\"https://velog.io/@imacoolgirlyo/JS-%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EC%9D%98-Hoisting-The-Execution-Context-%ED%98%B8%EC%9D%B4%EC%8A%A4%ED%8C%85-%EC%8B%A4%ED%96%89-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8-6bjsmmlmgy\">JS 자바스크립트의 The Execution Context (실행 컨텍스트) 와 Hoisting (호이스팅)</a></li>\n<li><a href=\"https://meetup.toast.com/posts/129\">자바스크립트 함수(3) - Lexical Environment : TOAST Meetup</a></li>\n<li><a href=\"https://blog.bitsrc.io/understanding-scope-and-scope-chain-in-javascript-f6637978cf53\">Understanding Scope and Scope Chain in JavaScript</a></li>\n<li><a href=\"http://dmitrysoshnikov.com/ecmascript/es5-chapter-3-2-lexical-environments-ecmascript-implementation/#lexical-environment\">ECMA-262-5 in detail. Chapter 3.2. Lexical environments</a></li>\n<li><a href=\"http://dmitrysoshnikov.com/ecmascript/javascript-the-core/#scope-chain\">JavaScript. The Core - Scope Chain</a></li>\n<li><a href=\"https://tyle.io/blog/54\">JS 스코프 체인 이란? -tyle.io</a></li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\"><a href=\"https://developer.mozilla.org/ko/docs/Web/JavaScript/%EC%96%B8%EC%96%B4_%EB%A6%AC%EC%86%8C%EC%8A%A4\">자바스크립트 언어 자료 - JavaScript MDN</a><a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","frontmatter":{"date":"September 09, 2019","title":"자바스크립트 동작원리와 ES6 - Fundamentals of JavaScript & ES6","categories":"개발","author":"개발한입","emoji":"💻"},"fields":{"slug":"/fundamentals-of-javascript/"}},"prev":{"id":"2d56fc77-4903-5159-a64c-f40e3e42384e","html":"<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#step-11-%EC%BD%9C%EB%A0%89%EC%85%98-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B3%A0%EB%AF%BC\">STEP 1.1 콜렉션 리팩토링에 대한 고민</a></p>\n<ul>\n<li><a href=\"#step-111-%EB%B9%84%EC%A6%88%EB%8B%88%EC%8A%A4%EC%97%90-%EC%A2%85%EC%86%8D%EC%A0%81%EC%9D%B8-%EC%9E%90%EB%A3%8C%EA%B5%AC%EC%A1%B0-%EC%83%9D%EC%84%B1\">STEP 1.1.1 비즈니스에 종속적인 자료구조 생성</a></li>\n<li><a href=\"#step-112-collection%EC%9D%98-%EB%B6%88%EB%B3%80%EC%84%B1%EC%9D%84-%EB%B3%B4%EC%9E%A5\">STEP 1.1.2 Collection의 불변성을 보장</a></li>\n<li><a href=\"#step-113-%EA%B3%BC%EC%A0%9C%EC%97%90%EC%84%9C-%ED%99%9C%EC%9A%A9%ED%95%9C-%EB%B0%A9%EB%B2%95\">STEP 1.1.3 과제에서 활용한 방법</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#step-12-%EC%9D%B8%EC%A1%B0%ED%82%A4%EC%99%80-%EC%9E%90%EC%97%B0%ED%82%A4%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B3%A0%EB%AF%BC\">STEP 1.2 인조키와 자연키에 대한 고민</a></p>\n</li>\n<li>\n<p><a href=\"#step-13-jpa-%EC%84%A4%EA%B3%84%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B3%A0%EB%AF%BC\">STEP 1.3 JPA 설계에 대한 고민</a></p>\n</li>\n<li>\n<p><a href=\"#step-21-jpa-lazyinitializationexception-%ED%95%B8%EB%93%A4%EB%A7%81\">STEP 2.1 JPA LazyInitializationException 핸들링</a></p>\n<ul>\n<li><a href=\"#step-211-jpa-%EC%A7%80%EC%97%B0%EB%A1%9C%EB%94%A9%EA%B3%BC-%EC%A6%89%EC%8B%9C%EB%A1%9C%EB%94%A9\">STEP 2.1.1 JPA 지연로딩과 즉시로딩</a></li>\n<li><a href=\"#step-212-jpa-n1-%EB%AC%B8%EC%A0%9C\">STEP 2.1.2 JPA N+1 문제</a></li>\n<li><a href=\"#step-213-fetch-join%EC%9D%84-%ED%86%B5%ED%95%9C-%ED%8A%B8%EB%9F%AC%EB%B8%94-%EC%8A%88%ED%8C%85\">STEP 2.1.3 Fetch Join을 통한 트러블 슈팅</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#step-22-%EB%8F%99%EC%9D%BC-%EA%B0%9D%EC%B2%B4-groupby-%ED%95%B8%EB%93%A4%EB%A7%81\">STEP 2.2 동일 객체 GroupBy 핸들링</a></p>\n</li>\n<li>\n<p><a href=\"#step-31-%EC%A0%95%EC%A0%81-%ED%8C%A9%ED%86%A0%EB%A6%AC-%EB%A9%94%EC%86%8C%EB%93%9C-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81-%EA%B4%80%EB%A0%A8\">STEP 3.1 정적 팩토리 메소드 리팩토링 관련</a></p>\n</li>\n</ul>\n</div>\n<ul>\n<li>STEP 1. 구현 중에 맞딱드린 고민과 해결방법\n<ul>\n<li>STEP 1.1 콜렉션 리팩토링에 대한 고민</li>\n<li>STEP 1.2 인조키와 자연키에 대한 고민</li>\n<li>STEP 1.3 JPA 설계에 대한 고민</li>\n</ul>\n</li>\n<li>STEP 2. 트러블 슈팅\n<ul>\n<li>STEP 2.1 JPA LazyInitializationException 핸들링</li>\n<li>STEP 2.2 동일 객체 GroupBy 핸들링</li>\n</ul>\n</li>\n<li>STEP 3. 아쉬운 점\n<ul>\n<li>STEP 3.1 정적 팩토리 메소드 리팩토링 관련</li>\n</ul>\n</li>\n<li>STEP 4. 참고자료(REFERENCE)</li>\n</ul>\n<h1 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h1>\n<p>모 스타트업의 과제 전형을 참가 한 뒤에 스스로 코드 리뷰 및 후기를 남기기 위해서 작성해보겠다.</p>\n<p>과제는 스프링을 활용한 작은 규모의 커맨드 라인 서비스를 만드는 것이었고, 더미테이블이 주어졌다.</p>\n<p>자세한 내용은 비밀로 유지해달라는 부탁을 받아서,  아쉽게도 전체 코드를 공개를 못하게 됐지만 내가 과제를 하면서 고민했던 부분들을 따로 정리하고자 이 포스트를 작성한다.</p>\n<h1 id=\"step-1-구현-중에-맞딱드린-고민과-해결방법\" style=\"position:relative;\"><a href=\"#step-1-%EA%B5%AC%ED%98%84-%EC%A4%91%EC%97%90-%EB%A7%9E%EB%94%B1%EB%93%9C%EB%A6%B0-%EA%B3%A0%EB%AF%BC%EA%B3%BC-%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95\" aria-label=\"step 1 구현 중에 맞딱드린 고민과 해결방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1. 구현 중에 맞딱드린 고민과 해결방법</h1>\n<h2 id=\"step-11-콜렉션-리팩토링에-대한-고민\" style=\"position:relative;\"><a href=\"#step-11-%EC%BD%9C%EB%A0%89%EC%85%98-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B3%A0%EB%AF%BC\" aria-label=\"step 11 콜렉션 리팩토링에 대한 고민 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1.1 콜렉션 리팩토링에 대한 고민</h2>\n<p>과제를 진행하면서 무분별하게 콜렉션이 남발되는 부분이 있었다.</p>\n<p>이를 처리하기 위해서 일급 콜렉션을 도입하자고 생각하였다.</p>\n<p>이전부터 일급 콜렉션을 활용하는 방법과 장점을 알고 있었으나, 개념만 익혀놨을 뿐 써보지는 않았었다. 그래서 간단하게 정의와 장점을 알고 넘어가고자 한다.</p>\n<p>일단, 먼저 일급 콜렉션이 무엇인지? 알아보고자 한다.</p>\n<p>아래와 같이 카드덱 클래스가 존재한다고 가정하자.</p>\n<p>카드덱 클래스는 Card객체의 List를 가지고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CardDeck</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> CARD_DECK_SIZE <span class=\"token operator\">=</span> <span class=\"token number\">13</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> PATTERN_A_NUMBER <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> PATTERN_J_NUMBER <span class=\"token operator\">=</span> <span class=\"token number\">11</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> PATTERN_Q_NUMBER <span class=\"token operator\">=</span> <span class=\"token number\">12</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> PATTERN_K_NUMBER <span class=\"token operator\">=</span> <span class=\"token number\">13</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Card</span><span class=\"token punctuation\">></span></span> cards <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>이런 List<Card> 를 Wrapping을 아래의 코드와 같이 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Cards</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Card</span><span class=\"token punctuation\">></span></span> cards<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Cards</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Card</span><span class=\"token punctuation\">></span></span> cards<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cards <span class=\"token operator\">=</span> cards<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>즉, 어떤 Collection을 <strong>Class로 Wrapping하는데 Wrapping한 대상이 된 Collection 의외에 다른 멤버변수가 없게 하는 것</strong>이 일급 콜렉션이다.</p>\n<p>이렇게 함으로써 어떤 장점을 가지게 될까?</p>\n<ol>\n<li>비즈니스에 종속적인 자료구조 생성</li>\n<li>Collection의 불변성(Immutable)을 보장</li>\n<li>상태와 행위를 한 곳에서 관리</li>\n<li>이름이 있는 콜렉션</li>\n</ol>\n<p>하나씩 살펴보고자 한다.</p>\n<h3 id=\"step-111-비즈니스에-종속적인-자료구조-생성\" style=\"position:relative;\"><a href=\"#step-111-%EB%B9%84%EC%A6%88%EB%8B%88%EC%8A%A4%EC%97%90-%EC%A2%85%EC%86%8D%EC%A0%81%EC%9D%B8-%EC%9E%90%EB%A3%8C%EA%B5%AC%EC%A1%B0-%EC%83%9D%EC%84%B1\" aria-label=\"step 111 비즈니스에 종속적인 자료구조 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1.1.1 비즈니스에 종속적인 자료구조 생성</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> patterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">CardSuit</span><span class=\"token punctuation\">.</span>SPADE<span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">CardSuit</span><span class=\"token punctuation\">.</span>HEART<span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">CardSuit</span><span class=\"token punctuation\">.</span>DIAMOND<span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">CardSuit</span><span class=\"token punctuation\">.</span>CLUB<span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">generatedCardDeckByPattern</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> pattern<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> CARD_DECK_SIZE<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">String</span> denomination <span class=\"token operator\">=</span> <span class=\"token function\">numberToDenomination</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">Card</span> card <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Card</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CardSuit</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>pattern<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> denomination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cards<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>card<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">generatedAllCardDeck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token class-name\">CardDeck</span><span class=\"token punctuation\">.</span>patterns<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">generatedCardDeckByPattern</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CardDeck</span><span class=\"token punctuation\">.</span>patterns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>CardDeck은 위와 같은 행위를 통하여 전체 카드 52장을 만들어 낸다.</p>\n<p>이때, 나는 enum(cardSuit)을 통하여 패턴(스페이드, 하트, 다이아, 클로버) 등을 처리했다.</p>\n<p>그렇다면 이에 대한 검증 로직은 어디서 처리해야될까?</p>\n<p>물론, CardDeck에서 처리해도 된다고 생각이 들지만, 만약 비즈니스 로직이 많아지면서 클래스에 방대한 로직들이 쌓이게 된다면 검증로직을 쉽사리 찾기도 힘들 것이다.</p>\n<p>또한, 코드나 도메인을 모르는 사람들이 볼 때도 문제가 발생할 소지가 있다.</p>\n<p>그래서 이것을 일급 콜렉션으로 뺀다면 다음과 같이 해결 할 수 있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Cards</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> CARDS_SIZE <span class=\"token operator\">=</span> <span class=\"token number\">52</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Card</span><span class=\"token punctuation\">></span></span> cards<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Cards</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Card</span><span class=\"token punctuation\">></span></span> cards<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">validationSize</span><span class=\"token punctuation\">(</span>cards<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">validateDuplicate</span><span class=\"token punctuation\">(</span>cards<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cards <span class=\"token operator\">=</span> cards<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">validationSize</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Card</span><span class=\"token punctuation\">></span></span> cards<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>cards<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> CARDS_SIZE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"전체 생성된 카드의 크기는 52장여야 합니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">validateDuplicate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Card</span><span class=\"token punctuation\">></span></span> cards<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Card</span><span class=\"token punctuation\">></span></span> nonDuplicatedCards <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>cards<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>nonDuplicatedCards<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> cards<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"카드는 중복 생성할 수 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 함으로서 비즈니스 로직에 종속적인 자료구조를 생성하며, 상태와 행위를 한 곳에 집중시킬 수 있으며, 이름을 갖는 콜렉션을 사용할 수 있다.</p>\n<h3 id=\"step-112-collection의-불변성을-보장\" style=\"position:relative;\"><a href=\"#step-112-collection%EC%9D%98-%EB%B6%88%EB%B3%80%EC%84%B1%EC%9D%84-%EB%B3%B4%EC%9E%A5\" aria-label=\"step 112 collection의 불변성을 보장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1.1.2 Collection의 불변성을 보장</h3>\n<p>여기서 가장 중요한 것은 콜렉션 특성상 <strong>Getter를 그대로 사용하면 레퍼런스 관계가 되어 값을 추가</strong> 할 수 있다. 따라서, 일급 콜렉션의 불변성을 보장하기 위해서는 <strong>필요한 값만을 반환</strong>하는 별도의 메소드들을 만들어서 사용해야 한다.</p>\n<p>나 또한, 별 생각없이 지나갔던 부분이었는데 이 부분은 <a href=\"https://woowacourse.github.io/javable/2020-05-08/First-Class-Collection\">일급 컬렉션을 사용하는 이유</a>를 보면서 알게되었다.</p>\n<p>해당 포스트의 샘플 코드를 몇개 가져와서 예시를 들어 설명해보겠다.</p>\n<p>로또 프로젝트를 진행한다고 가정했을 때 로또(Lotto)는 난수 6개인 로또번호(LottoNumber)를 리스트로 들고 있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Lotto</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LottoNumber</span><span class=\"token punctuation\">></span></span> lotto<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Lotto</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LottoNumber</span><span class=\"token punctuation\">></span></span> lotto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lotto <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>lotto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LottoNumber</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getLotto</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> lotto<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LottoNumber</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> lottoNumber<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">LottoNumber</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> lottoNumber<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lottoNumber <span class=\"token operator\">=</span> lottoNumber<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이때 위의 getLotto()와 같이 Getter를 사용하면 콜렉션과 레퍼런스 관계가 되기때문에 값을 추가할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> lotto_변화_테스트<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LottoNumber</span><span class=\"token punctuation\">></span></span> lottoNumbers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    lottoNumbers<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LottoNumber</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Lotto</span> lotto <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Lotto</span><span class=\"token punctuation\">(</span>lottoNumbers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    lottoNumbers<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LottoNumber</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>따라서 일급 콜렉션의 불변을 보장하고 싶으면 위와 같이 <strong>내부 변수를 그대로 반환하는 Getter의 사용</strong>을 지양해야한다. 즉, 콜렉션 값을 그대로 반환하는 것을 없애는 것이 좋다.</p>\n<p>만약 그것들이 필요하다 하면 <a href=\"https://woowacourse.github.io/javable/2020-05-08/First-Class-Collection\">일급 컬렉션을 사용하는 이유</a> 하단에 어떻게하면 불변을 보장하면서 Getter를 사용할 수 있는지 나온다.</p>\n<h3 id=\"step-113-과제에서-활용한-방법\" style=\"position:relative;\"><a href=\"#step-113-%EA%B3%BC%EC%A0%9C%EC%97%90%EC%84%9C-%ED%99%9C%EC%9A%A9%ED%95%9C-%EB%B0%A9%EB%B2%95\" aria-label=\"step 113 과제에서 활용한 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1.1.3 과제에서 활용한 방법</h3>\n<p>다시 과제 이야기로 돌아와 내가 일급 콜렉션을 쓰게 된 계기는 Order 클래스는 주문과 관계된 클래스다보니 비즈니스 로직이 많이 쌓일 수 밖에 없는 구조를 갖게되었다.</p>\n<p>그러다보니 자주 쓰는 콜렉션 중에서 주문과 관련된 콜렉션을 일급 콜렉션화하자라는 생각을 하게됐고, 아래와 같이 구현했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token comment\">//기본 생성자 제한</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span>PRIVATE<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderProductGroups</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">></span></span> orderProducts<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OrderProductGroups</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">></span></span> orderProducts<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>orderProducts <span class=\"token operator\">=</span> orderProducts<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">toMovieSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> orderProducts<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderProduct</span><span class=\"token operator\">::</span><span class=\"token function\">getProduct</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>product <span class=\"token operator\">-></span> product<span class=\"token punctuation\">.</span><span class=\"token function\">getProductType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equalsIgnoreCase</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"movie\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">toMovieList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> orderProducts<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderProduct</span><span class=\"token operator\">::</span><span class=\"token function\">getProduct</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>product <span class=\"token operator\">-></span> product<span class=\"token punctuation\">.</span><span class=\"token function\">getProductType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equalsIgnoreCase</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"movie\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\t  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>기존에 List<OrderProduct>를 사용했는데 Order 비즈니스 로직이 해당 리스트로 인하여 너무 지저분해지고 있었다. 따라서, List<OrderProduct>를 OrderProductGroups라는 일급콜렉션화를 진행하였다.</p>\n<p>이를 통해서 코드가 매우 간결해지고 깔끔해짐을 알 수 있었는데 어떤 결과가 생겼는지 알아보자.</p>\n<p>살펴볼 코드의 로직은 아주 단순하다. List를 Set으로 만들어 사이즈가 다를 경우 중복값이 존재하니 해당 경우에 예외를 던지는 코드였다.</p>\n<ul>\n<li>리팩토링 전</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkDuplicatedMovie</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">></span></span> orderProducts<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDuplicatedMovie</span><span class=\"token punctuation\">(</span>orderProducts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DuplicatedMovieOrderException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"같은 Movie를 여러 개 주문이 불가합니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isDuplicatedMovie</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">></span></span> orderProducts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> movies <span class=\"token operator\">=</span> orderProducts<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderProduct</span><span class=\"token operator\">::</span><span class=\"token function\">getProduct</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>product <span class=\"token operator\">-></span> product<span class=\"token punctuation\">.</span><span class=\"token function\">getProductType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equalsIgnoreCase</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"movie\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> movieSet <span class=\"token operator\">=</span> orderProducts<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderProduct</span><span class=\"token operator\">::</span><span class=\"token function\">getProduct</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>product <span class=\"token operator\">-></span> product<span class=\"token punctuation\">.</span><span class=\"token function\">getProductType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equalsIgnoreCase</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"movie\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> movies<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> movieSet<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>일급 콜렉션 사용을 통한 리팩토링 후</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkDuplicatedMovie</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderProductGroups</span> orderProductGroups<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isDuplicatedMovie</span><span class=\"token punctuation\">(</span>orderProductGroups<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DuplicatedMovieOrderException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"같은 Movie를 여러 개 주문이 불가합니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isDuplicatedMovie</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderProductGroups</span> orderProductGroups<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products <span class=\"token operator\">=</span> orderProductGroups<span class=\"token punctuation\">.</span><span class=\"token function\">toMovieList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> productSet <span class=\"token operator\">=</span> orderProductGroups<span class=\"token punctuation\">.</span><span class=\"token function\">toMovieSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> products<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> productSet<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 매우 깔끔해짐을 알 수가 있다. 또한, List<OrderProduct>에 영향을 받던 다른 코드들도 마찬가지로 깔끔하게 리팩토링을 할 수 있게 되었다.</p>\n<h2 id=\"step-12-인조키와-자연키에-대한-고민\" style=\"position:relative;\"><a href=\"#step-12-%EC%9D%B8%EC%A1%B0%ED%82%A4%EC%99%80-%EC%9E%90%EC%97%B0%ED%82%A4%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B3%A0%EB%AF%BC\" aria-label=\"step 12 인조키와 자연키에 대한 고민 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1.2 인조키와 자연키에 대한 고민</h2>\n<p>과제는 위에서 말한거처럼 더미테이블이 주어졌다. 이때 나는 Spring Data JPA를 도입하였는데 고민했던 부분은 PK 설정에 대한 부분이었다.</p>\n<p>혼자 프로젝트를 진행하거나 스터디를 진행했을 때는 PK를 단순하게 JPA 전략이 알아서하게끔 처리했었는데 이게 맞는 것인지에 대해서는 깊게 생각을 안했었다.</p>\n<p>하지만, 주어진 더미데이터에는 PK로 쓸 수 있는 부분이 있었고 이에 대해서 고민하기 시작했다. 이때, 인조키와 자연키에 대해서 알게 되었다.</p>\n<ul>\n<li>자연키(Natural Key)란?</li>\n</ul>\n<p><strong>비즈니스 모델에서 자연스레 나오는 속성을 기본키로 정하는 것</strong></p>\n<ul>\n<li>인조키(Artificial Key)란?</li>\n</ul>\n<p><strong>속성 중에서 기본키로 추출할 속성이 없어서 인위적으로 고유번호를 지정하는 것</strong></p>\n<p>자연키는 예시로 들 수 있는 것이 주민등록번호가 있을 것이다.</p>\n<p>인조키는 예시로 들 수 있는 것이 UUID나 DB 자체에서 생성된 시퀀스로 볼 수 있을 것이다.</p>\n<p>나는 자연키는 따로 필드를 빼두고 인조키를 PK로 활용하는 방안으로 설계를 진행하였다. 이 말은 그냥 JPA에서 알아서 PK를 처리하도록 하게끔 <code class=\"language-text\">@GeneratedValue(strategy = GenerationType.IDENTITY)</code> 전략을 활용하였다는 말이다.</p>\n<p>이 부분에 대해서 좀 더 알고 싶으면 해당 포스팅을 추천한다.</p>\n<p><a href=\"https://multifrontgarden.tistory.com/180\">기본키는 무엇으로 할까 - 자연키, 인조키</a></p>\n<h2 id=\"step-13-jpa-설계에-대한-고민\" style=\"position:relative;\"><a href=\"#step-13-jpa-%EC%84%A4%EA%B3%84%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B3%A0%EB%AF%BC\" aria-label=\"step 13 jpa 설계에 대한 고민 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1.3 JPA 설계에 대한 고민</h2>\n<p>주어진 과제에서 상품(Item)을 처리하는 부분이 있었는데 상품은 2개의 카테고리로 분리되어있었다. 그러나, 이것을 제외하고는 모든 필드가 동일하였다.</p>\n<p>만약, 두 카테고리가 다른 부분이 존재하였으면 공통부분은 추상클래스로 뺀 후에 처리를 했을 것 같다. 하지만 모든 필드가 동일한 것에 대해서는 어떻게 처리해야될까 고민했다.</p>\n<ul>\n<li>카테고리 클래스를 따로 빼서 처리해야될까?</li>\n<li>각각 카테고리로 나눠진 상품의 개별 클래스를 나눠서 짤까?</li>\n</ul>\n<p>결론 끝에 도달한 것은 상품이라는 클래스는 언제나 변화무쌍할 수 있다는 것이다. 과제에서 주어진 요구사항은 단순했지만, 각각 카테고리에 나중에 부분적으로 변화할 수 있는 부분들이 있다고 생각하였다.</p>\n<p>또한, 상태는 같아도 행위자체는 다르게 동작해야하는 부분들이 존재했다.</p>\n<p>따라서, 확장 가능성과 유지보수의 용이성으로 볼 때 추상클래스를 도입하는게 좋다고 판단하였다.</p>\n<ul>\n<li>추상클래스 Product</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"tbl_prod\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@DiscriminatorColumn</span>\n<span class=\"token annotation punctuation\">@Inheritance</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">InheritanceType</span><span class=\"token punctuation\">.</span>SINGLE_TABLE<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Product</span> <span class=\"token punctuation\">{</span>\n\t\t\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"prod_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span> <span class=\"token comment\">//인조키</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"prod_key\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Long</span> naturalKey<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 자연키 = 상품번호</span>\n\n    <span class=\"token comment\">// @DiscriminatorColumn 기본값이 dtype이다. </span>\n    <span class=\"token comment\">// 카테고리에 따라서 다르게 동작해야할 로직이 존재해서 카테고리 참조를 위해 추가</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"dtype\"</span><span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> updatable<span class=\"token operator\">=</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> insertable<span class=\"token operator\">=</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">String</span> productType<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>자식클래스 Book</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"tbl_book\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@DiscriminatorValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"book\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@PrimaryKeyJoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"book_id\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// JPA 기본 생성자 생성 제한</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span>PROTECTED<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Product</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 상태 존재 X</span>\n    <span class=\"token comment\">// 추상클래스 상태의 접근제어자들이 protected로 선언 되어있음</span>\n    <span class=\"token comment\">// 자식 클래스에서 concrete object로 생성하게끔 함.</span>\n    <span class=\"token annotation punctuation\">@Builder</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Book</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> naturalKey<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> productType<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>naturalKey <span class=\"token operator\">=</span> naturalKey<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>productType <span class=\"token operator\">=</span> productType<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>과제의 기한이 7일이 주어진 타임어택형 과제였기 때문에, JPA의 Inheritance strategy로 <code class=\"language-text\">SINGLE_TABLE</code> 전략을 활용하기로 했다. 물론, <code class=\"language-text\">JOINED</code> 전략이 훨씬 정규화되어있고 좋기야하겠지만 가뜩이나 처리가 빡센 JPA 조인을 트러블 슈팅을 하면서 시간을 쓸 바에는 간단한 <code class=\"language-text\">SINGLE_TABLE</code> 전략이 낫다고 생각하여 채택했다.</p>\n<p>JPA의 상속 전략에 대해서 알고 싶으면 <a href=\"https://ict-nroo.tistory.com/128\">[JPA] 상속관계 매핑 전략(@Inheritance, @DiscriminatorColumn)</a> 이 포스팅을 읽어보도록 하자.</p>\n<h1 id=\"step-2-트러블-슈팅\" style=\"position:relative;\"><a href=\"#step-2-%ED%8A%B8%EB%9F%AC%EB%B8%94-%EC%8A%88%ED%8C%85\" aria-label=\"step 2 트러블 슈팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2. 트러블 슈팅</h1>\n<h2 id=\"step-21-jpa-lazyinitializationexception-핸들링\" style=\"position:relative;\"><a href=\"#step-21-jpa-lazyinitializationexception-%ED%95%B8%EB%93%A4%EB%A7%81\" aria-label=\"step 21 jpa lazyinitializationexception 핸들링 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2.1 JPA LazyInitializationException 핸들링</h2>\n<p><img src=\"https://user-images.githubusercontent.com/22961251/98634956-05e6cb80-231c-11eb-98ae-7c59859fe0d0.png\" alt=\"ERD\"></p>\n<p>위의 구조는 내가 사용한 JPA 객체 관계를 표시한 다이어그램이라 볼 수 있다.</p>\n<p>Product ↔ Order는 다대다의 관계를 갖는데, JPA에서 <code class=\"language-text\">@ManyToMany</code> 키워드로 테이블을 생성하면 아래와 같이 조인을 위한 OrderProduct 테이블이 생성된다.</p>\n<p>그러나, 기본 생성되는 연결 테이블(OrderProduct)은 필드를 추가하거나 제거하거나 혹은 비즈니스 로직을 담을 수 없다.</p>\n<p>왜냐하면, 기본 생성되는 조인 테이블은 매핑 정보만 넣는 것이 가능하고, 추가 정보를 넣는 것 자체가 불가능하기 때문이다. 또한, Order와 Product는 엔티티를 우리가 생성한거여서 내부적으로 비즈니스 로직이나 검증처리를 할 수 있지만, OrderProduct 테이블은 자체 생성되는 것이기 때문에 그러한 로직처리가 불가능하다.</p>\n<p>따라서, ManyToMany 관계는 조인 테이블 엔티티를 따로 만든 후에 일대다, 다대일 관계로  풀어주는 것이 맞다.</p>\n<p>즉, 기본 생성되는 연결 테이블을 엔티티로 승격해주는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"tbl_order_prod\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span>PROTECTED<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderProduct</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"order_prod_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\t\t\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"prod_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Product</span> product<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"order_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">;</span>\n\n   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이런 식으로 연결 테이블을 엔티티로 승격시킬 수가 있다.</p>\n<p>그렇다면 지금까지 이야기한 내용과 <code class=\"language-text\">LazyInitializationException</code>과 무슨 상관관계가 있을까?</p>\n<p>주목해야될 것은 <code class=\"language-text\">@ManyToOne(fetch = FetchType.LAZY)</code> 부분이다.</p>\n<h3 id=\"step-211-jpa-지연로딩과-즉시로딩\" style=\"position:relative;\"><a href=\"#step-211-jpa-%EC%A7%80%EC%97%B0%EB%A1%9C%EB%94%A9%EA%B3%BC-%EC%A6%89%EC%8B%9C%EB%A1%9C%EB%94%A9\" aria-label=\"step 211 jpa 지연로딩과 즉시로딩 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2.1.1 JPA 지연로딩과 즉시로딩</h3>\n<p>JPA에서는 엔티티를 조회할 때 두 가지 방식을 사용할 수 있다.</p>\n<p>바로, **즉시로딩(Eager Loading)**과 **지연로딩(Lazy Loading)**이다.</p>\n<p>두 개는 무슨 차이일까?</p>\n<p>아래와 같은 코드가 가정하고 살펴보자.</p>\n<ul>\n<li>Member 엔티티</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Member</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token annotation punctuation\">@ManyToOne</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Team</span> team<span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Team 엔티티</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Team</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 Member 엔티티와 Team  엔티티가 있고, 팀과 회원을 모두 출력하는 로직과 회원만 출력하는 로직이 있다고 하자.</p>\n<ul>\n<li>회원과 팀 정보를 출력하는 비즈니스 로직</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">printUserAndTeam</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> memberId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">Team</span> team <span class=\"token operator\">=</span> member<span class=\"token punctuation\">.</span><span class=\"token function\">getTeam</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"회원 이름 : \"</span> <span class=\"token operator\">+</span> member<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"소속팀 : \"</span> <span class=\"token operator\">+</span> team<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>회원만 출력하는 비즈니스 로직</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">printUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> memberId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> em<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"회원 이름 : \"</span> <span class=\"token operator\">+</span> member<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>코드를 보면 알겠지만, Team과 Member 엔티티가 연관관계에 있어도 회원만 출력하는 경우 Team까지 함께 조회하는 것을 효율적이지 않다.</p>\n<p>JPA는 이러한 문제를 해결하려고 <strong>엔티티가 실제 사용될 때까지 데이터베이스 조회를 지연하는 것을 제공</strong>하는데 그것이 지연로딩(Lazy Loading)이다.</p>\n<p>쉽게 이야기해서 Team과 Member가 연관관계에 있어도 team.getTeam()과 같이 직접적으로 사용하지 않을 때는 DB에 접근해서 가져오지 않는 것을 말한다.</p>\n<p>이러한 지연로딩을 처리하기 위해서 실제 엔티티 객체 대신에 데이터베이스 조회를 지연할 객체가 필요한데 이것을 프록시객체라 한다.</p>\n<p>지연로딩과 즉시로딩을 정리를 하면 다음과 같다.</p>\n<ul>\n<li><strong>즉시 로딩(Eager Loading)</strong> : <strong>엔티티를 조회할 때 연관된 엔티티도 함께 조회된다.</strong>\n<ul>\n<li>예) em.find(Member.class, memberId)를 하게되면 Team 엔티티도 조회된다.</li>\n<li>사용 방법 : @ManyToOne(fetch = fetchType.EAGER)</li>\n</ul>\n</li>\n<li><strong>지연 로딩(Lazy Loading)</strong> : <strong>연관된 엔티티를 실제 사용할 때 조회한다.</strong>\n<ul>\n<li>예) member.getTeam().getName() 처럼 조회한 팀을 실제 사용할 때 SQL를 호출한다.</li>\n<li>사용 방법 : @ManyToOne(fetch = fetchType.LAZY)</li>\n</ul>\n</li>\n</ul>\n<p>그런데, 나는 모든 페치 전략을 LAZY로 둔 상태였다.</p>\n<p>일부로 즉시 로딩의 사용을 배제한 채 모두 지연 로딩으로 설정했는데 그 이유는 다음과 같다.</p>\n<ol>\n<li>\n<p><strong>예상치 못한 SQL이 발생한다.</strong></p>\n<p>→ 연관관계를 5개를 들고 있는 엔티티면 조인이 5번 일어난다.</p>\n</li>\n<li>\n<p><strong>JPQL에서 즉시로딩은 N+1 문제를 일으킨다.</strong></p>\n<p>→ LAZY 페치전략도 N+1문제를 일으키긴하지만 EAGER의 경우 심각하다</p>\n</li>\n</ol>\n<p>해당 케이스를 좀 더 깊게 보기 위해서 N+1 문제에 대해서 알아보고자 한다.</p>\n<h3 id=\"step-212-jpa-n1-문제\" style=\"position:relative;\"><a href=\"#step-212-jpa-n1-%EB%AC%B8%EC%A0%9C\" aria-label=\"step 212 jpa n1 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2.1.2 JPA N+1 문제</h3>\n<p>해당 예시를 살펴보기 위해서 <a href=\"https://www.popit.kr/jpa-n1-%EB%B0%9C%EC%83%9D%EC%9B%90%EC%9D%B8%EA%B3%BC-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95/\">JPA N+1 발생원인과 해결 방법</a> 포스팅의 예제 코드를 가져왔다.</p>\n<ul>\n<li>즉시로딩 N+1 문제</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Entity</span>\n<span class=\"token annotation builtin\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"member\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> Member <span class=\"token keyword\">private</span> <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span>\n    <span class=\"token annotation builtin\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"member\"</span><span class=\"token punctuation\">,</span> fetch <span class=\"token operator\">=</span> FetchType<span class=\"token punctuation\">.</span>EAGER<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> orders<span class=\"token operator\">:</span> Set<span class=\"token operator\">&lt;</span>Order<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">emptySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">set</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation builtin\">@Entity</span>\n<span class=\"token annotation builtin\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> Order <span class=\"token keyword\">private</span> <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span>\n    <span class=\"token annotation builtin\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> FetchType<span class=\"token punctuation\">.</span>EAGER<span class=\"token punctuation\">)</span>\n    <span class=\"token annotation builtin\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"member_id\"</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> updatable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">lateinit</span> <span class=\"token keyword\">var</span> member<span class=\"token operator\">:</span> Member\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">set</span></code></pre></div>\n<p>코틀린이지만, 우리가 중요하게 보면 되는 부분은 연관 관계 부분이다. 해당 코드는 Member ↔ Order의 연관관계를 갖는데, 이 경우에 Member를 조회해도 Order를 가져오기 때문에 N+1 문제가 발생한다.</p>\n<p>예를 들면, Member가 1명이고, Order가 10개인 경우에도 Select 쿼리가 10번 나가는 것을 확인할 수 있다.</p>\n<p>즉, N+1 문제는 <strong>N + 1 → 1 (회원) + N (주문)</strong> 과 같이 1번 조회에 대해서 해당 조회에 연관관계가 얽힌 엔티티의 개수(N) 만큼 추가적으로 조회하는 문제이다. 만약, 주문 이외에 배송정보나 쿠폰정보 등이 포함되게 된다면, N + 1 쿼리는</p>\n<p>**1(회원) + N(주문) + N(배송정보) + N(쿠폰정보)**와 같이 매우 많은 쿼리가 발생하게 된다.</p>\n<p>이는 최악의 경우(Worst Case) 인데, 그 이유는 찾으려고 하는 값이 영속성 컨텍스트 내 존재하게 되면 조회 쿼리가 나가지는 않기 때문이다.</p>\n<p>그렇다면 <strong>지연로딩(Lazy Loading)을 통해서 N+1 문제를 해결 할 수 있을까?</strong></p>\n<p>가능하다. 해당 코드의 fetch = FetchType.EAGER를 LAZY로 바꾸면 Member를 조회할 때 1번만 조회가 된다.</p>\n<p>→ <strong>Order를 실제 사용하기 전까지 Select해서 Order를 가져오지 않기 때문이다.</strong></p>\n<p>그러나, <strong>다른 케이스에서는 지연로딩을 사용하더라도 N+1 문제가 발생할 수 있다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Test</span>\n<span class=\"token keyword\">internal</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">`지연로딩인 n+1`</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> members <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 회원 한명에 대한 조회는 문제가 없다</span>\n    <span class=\"token keyword\">val</span> firstMember <span class=\"token operator\">=</span> members<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order size : <span class=\"token interpolation\"><span class=\"token delimiter variable\">${</span>firstMember<span class=\"token punctuation\">.</span>orders<span class=\"token punctuation\">.</span>size<span class=\"token delimiter variable\">}</span></span>\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 조회한 모든 회원에 대해서 조회하는 경우 문제 발생</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>member <span class=\"token keyword\">in</span> members<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"order size: <span class=\"token interpolation\"><span class=\"token delimiter variable\">${</span>member<span class=\"token punctuation\">.</span>orders<span class=\"token punctuation\">.</span>size<span class=\"token delimiter variable\">}</span></span>\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 <code class=\"language-text\">findAll()</code>로 구한 members의 각각 해당하는 Order를 구하려고 하면, N+1 문제가 지연로딩에서도 동일하게 발생함을 알 수가 있다.</p>\n<p>이 케이스에서는 왜 N+1 문제가 발생하는 것일까?</p>\n<p>원인은 JPQL때문이다. <strong>JPQL은 글로벌 페치 전략을 완전히 무시하고 SQL을 실행한다.</strong></p>\n<p><code class=\"language-text\">memberRepository.findAll()</code>은 <code class=\"language-text\">select * from member</code>와 같은 SQL을 생성한다.</p>\n<p>아래와 같은 코드가 즉시 로딩과 지연 로딩에서 어떤 차이를 갖는지 알아보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">val</span> members <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>즉시로딩인 경우</li>\n</ul>\n<ol>\n<li><code class=\"language-text\">select * from member</code>가 members에 바인딩</li>\n<li>members의 글로벌 페치 전략이 EAGER이기 때문에 바인딩 된 후에 추가로 Order 객체 Select</li>\n</ol>\n<ul>\n<li>지연로딩인 경우</li>\n</ul>\n<ol>\n<li><code class=\"language-text\">select * from member</code>가 members에 바인딩</li>\n<li>members의 글로벌 페치 전략이 LAZY이기 때문에 바인딩 된 후 실제 Order 접근 시까지 조회쿼리 발생 X</li>\n<li>각 member의 order를 처리 → order 실제 사용 <code class=\"language-text\">member.order.size</code></li>\n<li>order를 조회해야함 → 즉, member 1건당 order 조회 N번 수행 N+1 문제 발생</li>\n</ol>\n<p>즉, 지연로딩인 경우에는 <strong><code class=\"language-text\">@OneToMany</code> 관계를 갖고 있는 Collection 내용에 접근할 때 N+1 문제가 발생한다.</strong></p>\n<p>변수에 접근할 때마다 쿼리가 날아가는 것이다.</p>\n<p>이 N+1 문제를 해결하기 위해서 자주 쓰는 방법 중에 하나가 **페치 조인(Fetch Join)**이 있다.</p>\n<p>하지만, 나 같은 경우에는 N+1 문제가 발생한 부분도 있었지만 다른 문제도 갖고 있었는데 바로 <code class=\"language-text\">LazyInitializationException</code> 문제였다. 이것 또한 fetch join으로 해결 하였는데 어떻게 해결했는지 알아보자</p>\n<h3 id=\"step-213-fetch-join을-통한-트러블-슈팅\" style=\"position:relative;\"><a href=\"#step-213-fetch-join%EC%9D%84-%ED%86%B5%ED%95%9C-%ED%8A%B8%EB%9F%AC%EB%B8%94-%EC%8A%88%ED%8C%85\" aria-label=\"step 213 fetch join을 통한 트러블 슈팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2.1.3 Fetch Join을 통한 트러블 슈팅</h3>\n<p>내가 수행한 과제의 경우에서 Product ↔ OrderProduct ↔ Order의 연관관계를 갖고 있었다.</p>\n<p>N+1 문제는 사실 Fetch Join을 많이 사용하는 용례를 설명하기 위해서도 있고 정리를 위해서 겸사겸사 정리하였다.</p>\n<p>나에게 더 중요한 문제는 <code class=\"language-text\">LazyInitializationException</code> 핸들링이었다.</p>\n<ul>\n<li>OrderResponseInfo (Order DTO 클래스)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span>PRIVATE<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderResponseInfo</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">></span></span> orderProducts<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OrderResponseInfo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>orderProducts <span class=\"token operator\">=</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getOrderProducts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Order와 OrderProduct가 연관관계를 맺는 부분</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"order\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span>ALL<span class=\"token punctuation\">,</span> orphanRemoval <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">></span></span> orderProducts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>Order는 OrderProduct와 @OneToMany 관계를 가지고 있다. OrderProduct는 아까전에 JPA 설계에 대한 고민 부분을 보면 Order와 Product가 @OneToMany 관계로 연결된 테이블을 엔티티로 승격시켰다고 말했었다.</p>\n<p>여기서 내가 <code class=\"language-text\">LazyInitializationException</code> 예외를 맞딱드린 부분은 컨트롤러 부분에서 상품명을 출력할 때였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">printProductTitle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderResponseInfo</span> dto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderProduct</span> orderProduct <span class=\"token operator\">:</span> dto<span class=\"token punctuation\">.</span><span class=\"token function\">getOrderProducts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// LazyInitializationException 발생!</span>\n       writer<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>orderProduct<span class=\"token punctuation\">.</span><span class=\"token function\">getProduct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTitle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n               <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" - \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>orderProduct<span class=\"token punctuation\">.</span><span class=\"token function\">getCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n               <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"개\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>왜 발생한 것일까?  하이버네이트 API를 보면 해당 예외는 다음과 같을 때 발생한다고 한다.</p>\n<blockquote>\n<p>Indicates access to unfetched data outside of a session context. For example, when an uninitialized proxy or collection is accessed after the session was closed.</p>\n</blockquote>\n<p>즉, 세션 컨텍스트 외부에 페치되지 않은 객체에 접근하고자 할 때 발생하는 예외인데 이를 쉽게 설명하자면 나는 지연로딩을 사용하고 있기 때문에 상위 엔티티를 조회했다고 한들 하위 엔티티가 직접적으로 가져와지지 않은 상태기 때문에 에러가 발생하는 것이다.</p>\n<ol>\n<li>\n<p>조회 서비스가 Select를 위한 서비스 (트랜잭션이 걸린)에 조회 요청을 한다.</p>\n</li>\n<li>\n<p>조회 결과가 반환 되면서 트랜잭션 종료</p>\n<ul>\n<li>이때 Entity는 영속상태가 아니라, 준영속 상태로 빠진다.</li>\n<li>만약 EAGER 패치로 가져왔다면 Entity의 하위 Entity가 함께 가져왔을 것이다.</li>\n</ul>\n<p>→ <strong>그러나, Lazy로 가져온 경우라면 하위 엔티티는 존재하지 않는 상태.</strong></p>\n</li>\n<li>\n<p>Lazy 로 가져온 데이터가 준 영속 상태에서 하위 엔티티를 조회하면 <code class=\"language-text\">LazyInitializationException</code>이 발생한다.</p>\n</li>\n</ol>\n<p>즉, 내 케이스의 경우에는 <strong>OrderProduct를 가져왔어도 하위 엔티티인 Product는 가져오지 않은 상태</strong>이다. 따라서 하위 엔티티에 대해서 조회하고자 하면 해당 예외가 발생하는 것이다.</p>\n<p>이를 아주 간단하게 아래와 같이 해결할 수 있다.</p>\n<ul>\n<li>Fetch Join 사용을 통한 LazyInitializationException 트러블 슈팅</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">OrderRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Order</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select distinct o from Order o \"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"join fetch o.orderProducts op \"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"join fetch op.product p \"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"where o.id=?1\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Order</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Fetch Join을 사용하게 되면 <strong>연관관계가 얽힌 객체를 조회할 때 프록시 객체를 사용하는 것이 아니라 실제 엔티티를 조회</strong>한다. 따라서, 이를 통하여 연관 객체를 한번에 가져올 수 있는 것이다. LazyInitializationException뿐만 아니라 N+1 문제도 실제 엔티티를 조회하면서 연관 객체를 한번에 가져오면서 해결 할 수 있다.</p>\n<p>단, Fetch Join도 한계점이 존재한다.</p>\n<p>해당 내용은 <a href=\"https://www.popit.kr/jpa-n1-%EB%B0%9C%EC%83%9D%EC%9B%90%EC%9D%B8%EA%B3%BC-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95/\">JPA N+1 발생원인과 해결 방법</a>과 김영한님의 인프런 강의 <a href=\"https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-API%EA%B0%9C%EB%B0%9C-%EC%84%B1%EB%8A%A5%EC%B5%9C%EC%A0%81%ED%99%94\">스프링부트-JPA-API개발-성능최적화</a> 섹션 3부분에 아주 잘나와있으니 참고해보자.</p>\n<h2 id=\"step-22-동일-객체-groupby-핸들링\" style=\"position:relative;\"><a href=\"#step-22-%EB%8F%99%EC%9D%BC-%EA%B0%9D%EC%B2%B4-groupby-%ED%95%B8%EB%93%A4%EB%A7%81\" aria-label=\"step 22 동일 객체 groupby 핸들링 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2.2 동일 객체 GroupBy 핸들링</h2>\n<p>동일한 상품이 단 건으로 여러번 주문 됐을 때,  하나의 그룹으로 묶는 것을 수행하고 싶었다.</p>\n<p>이를 테면, 메로나 1개 / 메로나 3개 → 메로나 4개 이런식으로 말이다.</p>\n<p>이는 과제의 요구사항에는 없는 부분이였지만 모든 기능을 구현 후에 시간이 남아서 따로 처리했었다.</p>\n<p>스트림을 그렇게 잘 다루는 편이 아니라 생각보다 오래걸렸었다.</p>\n<ul>\n<li>GroupBy를 위한 Mapping용 객체</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span>PRIVATE<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MappingOrderProduct</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MappingOrderProduct</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderProduct</span> orderProduct<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> orderProduct<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">groupingByOrderProducts</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderProductGroups</span> orderProductGroups<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> groupingMap <span class=\"token operator\">=</span> <span class=\"token function\">getGroupingMap</span><span class=\"token punctuation\">(</span>orderProductGroups<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">></span></span> orderProducts <span class=\"token operator\">=</span> orderProductGroups<span class=\"token punctuation\">.</span><span class=\"token function\">removeDuplicate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">updateGroupingOrderCount</span><span class=\"token punctuation\">(</span>groupingMap<span class=\"token punctuation\">,</span> orderProducts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> orderProducts<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateGroupingOrderCount</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> groupingMap<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">></span></span> orderProducts<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderProduct</span> orderProduct <span class=\"token operator\">:</span> orderProducts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Integer</span> groupingCount <span class=\"token operator\">=</span> groupingMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>orderProduct<span class=\"token punctuation\">.</span><span class=\"token function\">getProduct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getNaturalKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            orderProduct<span class=\"token punctuation\">.</span><span class=\"token function\">updateCount</span><span class=\"token punctuation\">(</span>groupingCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getGroupingMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderProductGroups</span> orderProductGroups<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MappingOrderProduct</span><span class=\"token punctuation\">></span></span> productGroups <span class=\"token operator\">=</span> orderProductGroups<span class=\"token punctuation\">.</span><span class=\"token function\">toProductGroups</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">createGroupingMapByProductGroups</span><span class=\"token punctuation\">(</span>productGroups<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">createGroupingMapByProductGroups</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MappingOrderProduct</span><span class=\"token punctuation\">></span></span> productGroups<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> productGroups<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token function\">groupingBy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MappingOrderProduct</span><span class=\"token operator\">::</span><span class=\"token function\">getNaturalKey</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token function\">summingInt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MappingOrderProduct</span><span class=\"token operator\">::</span><span class=\"token function\">getOrderCount</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>자연키를 통하여 기존 주문상품 리스트를 groupingBy를 한 후 주문 갯수를 summingInt를 통하여 합산한 Map 생성</li>\n<li>기존 주문상품 리스트를 자연키를 통하여 중복 제거 수행</li>\n<li>Map을 통하여 합산된 주문 개수를 기존 주문상품 리스트에 업데이트하여 리턴</li>\n</ol>\n<p>이러한 방식으로 처리하였다.</p>\n<p>중복 제거는 일급 콜렉션으로 만든 OrderProductGroups에 구현해놨는데 아래와 같이 짰다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">removeDuplicate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> orderProducts<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token function\">distinctBy</span><span class=\"token punctuation\">(</span>orderProduct <span class=\"token operator\">-></span> orderProduct<span class=\"token punctuation\">.</span><span class=\"token function\">getProduct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getNaturalKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Predicate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">distinctBy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">super</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> f<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> objects <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> t <span class=\"token operator\">-></span> objects<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h1 id=\"step-3-아쉬운-점\" style=\"position:relative;\"><a href=\"#step-3-%EC%95%84%EC%89%AC%EC%9A%B4-%EC%A0%90\" aria-label=\"step 3 아쉬운 점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 3. 아쉬운 점</h1>\n<p>과제를 진행할 당시에는 몰랐지만, 혼자서 코드 리뷰를 한 뒤에 느낀 아쉬운 점을 적어보겠다.</p>\n<h2 id=\"step-31-정적-팩토리-메소드-리팩토링-관련\" style=\"position:relative;\"><a href=\"#step-31-%EC%A0%95%EC%A0%81-%ED%8C%A9%ED%86%A0%EB%A6%AC-%EB%A9%94%EC%86%8C%EB%93%9C-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81-%EA%B4%80%EB%A0%A8\" aria-label=\"step 31 정적 팩토리 메소드 리팩토링 관련 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 3.1 정적 팩토리 메소드 리팩토링 관련</h2>\n<p>위에서 설명한 것과 같이 Product를 추상 클래스로 선언 후에 사용했었다 얘기를 했었다.</p>\n<p>그래서 concrete object인 Product를 extends한 하위 클래스를 생성할 때 빌더 패턴과 정적 팩토리 메소드 패턴을 활용했었다.</p>\n<ul>\n<li>하위 클래스의 Builder 부분</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Builder</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">Movie</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> naturalKey<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>naturalKey <span class=\"token operator\">=</span> naturlKey<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\t\t\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Movie</span> <span class=\"token function\">createMovie</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> naturalKey<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">validation</span><span class=\"token punctuation\">(</span>naturalKey<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">Movie</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t        <span class=\"token punctuation\">.</span><span class=\"token function\">naturalKey</span><span class=\"token punctuation\">(</span>naturalKey<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\t        <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>구현한 정적 팩토리 메소드 패턴</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductFactory</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Product</span> <span class=\"token function\">createProduct</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductRequestInfo</span> dto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Movie\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equalsIgnoreCase</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">.</span><span class=\"token function\">getProductType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">Movie</span><span class=\"token punctuation\">.</span><span class=\"token function\">createMovie</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">.</span><span class=\"token function\">getNaturalKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> \n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Product 객체를 생성할 수 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Product</span> <span class=\"token function\">getProduct</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductResponseInfo</span> dto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Movie\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equalsIgnoreCase</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">.</span><span class=\"token function\">getProductType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">Movie</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMovie</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> \n\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Product 객체를 생성할 수 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>사실 어떻게 보면 팩토리 패턴에 가까이 설계 했는데, 카테고리마다 다른 concrete object를 생성하기 때문에 분기 처리를 하여 처리했다.</p>\n<p>여기서 Factory를 사용한 이유는 createProduct로 알맞은 Request DTO가 들어왔을 때 카테고리 분류에 따라서 concrete object를 생성하기 위함이었다. 서브 클래스 내부의 create 메소드는 따로 사용할 때가 있다고 판단해서 냅둔 것인데 이렇게 처리하는 것은 어쨋든 간 productFactory를 사용하는 게 아니라 subclass의 create 메소드가 노출될 확률이 있다고 생각한다.</p>\n<p>또한 하위 클래스 내부에 validation 메소드를 집어 넣었는데 try를 통하여 exception을 캐치하는 것이 아니라 IllegalArgumentException을 따로 던져주는 것을 확인 할 수 있었다.</p>\n<p>이 부분은 try-catch로 처리해야된다고 생각한다.</p>\n<p>이 부분을 다시 리팩토링해보면 이렇게 될 것같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// Subclass </span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Product</span> <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductRequestInfo</span> dto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">validation</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">.</span><span class=\"token function\">getNaturalKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">Movie</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t        <span class=\"token punctuation\">.</span><span class=\"token function\">naturalKey</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">.</span><span class=\"token function\">getNaturalKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\t        <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Factory</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Product</span> <span class=\"token function\">createProduct</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductRequestInfo</span> dto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Product</span> product <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">isMovie</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Movie\"</span><span class=\"token punctuation\">,</span> dto<span class=\"token punctuation\">.</span><span class=\"token function\">getProductType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            product <span class=\"token operator\">=</span> <span class=\"token class-name\">Movie</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>dto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> \n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IllegalArgumentException</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> product<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다른 방법은 아예 Factory를 없애고, 추상 클래스에 <code class=\"language-text\">isMovie()</code>과 같은 메소드를 추가하여 서브클래스에서 구현한 뒤에 처리하는 방법도 있을 것 같다.</p>\n<p>추상 클래스에 빌더 패턴을 적용하는 등 아쉬운 부분이 있지만, 이것은 지금 구현된 아키텍처에는 굳이 적용하지 않아도 될 부분이라고 생각하여 생략한다.</p>\n<p>또한, TDD나 기타 등등 쓸 내용이 더 많지만, 제일 시간을 오래쏟고 고민했던 것들 위주로 정리해봤다.</p>\n<p>그래도 나름 열심히 짜서 과제 전형에 합격해서 기분은 좋다 ㅎㅎ</p>\n<p><img src=\"https://user-images.githubusercontent.com/22961251/98634965-0da67000-231c-11eb-884d-d40a26cce4b3.png\" alt=\"합격\"></p>\n<h1 id=\"step-4-reference\" style=\"position:relative;\"><a href=\"#step-4-reference\" aria-label=\"step 4 reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 4. REFERENCE</h1>\n<p><a href=\"https://jojoldu.tistory.com/412\">일급 컬렉션 (First Class Collection)의 소개와 써야할 이유</a></p>\n<p><a href=\"https://woowacourse.github.io/javable/2020-05-08/First-Class-Collection\">일급 컬렉션을 사용하는 이유</a></p>\n<p><a href=\"https://multifrontgarden.tistory.com/180\">기본키는 무엇으로 할까 - 자연키, 인조키</a></p>\n<p><a href=\"https://ict-nroo.tistory.com/132\">JPA - 즉시 로딩과 지연 로딩(FetchType.LAZY or EAGER)</a></p>\n<p><a href=\"https://ict-nroo.tistory.com/127\">JPA - @ManyToMany, 다대다[N:M] 관계</a></p>\n<p><a href=\"https://www.popit.kr/jpa-n1-%EB%B0%9C%EC%83%9D%EC%9B%90%EC%9D%B8%EA%B3%BC-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95/\">JPA N+1 발생원인과 해결방법</a></p>\n<p><a href=\"https://meetup.toast.com/posts/87\">JPA N+1 쿼리 문제와 해결</a></p>\n<p><a href=\"https://kapentaz.github.io/jpa/hibernate/@ManyToOne%EC%9D%98-N+1-%EB%AC%B8%EC%A0%9C-%EC%9B%90%EC%9D%B8-%EB%B0%8F-%ED%95%B4%EA%B2%B0/#\">@ManyToOne의-N+1-문제-원인-및-해결</a></p>\n<p><a href=\"https://uncle-bae.blogspot.com/2015/12/hibernate-lazyinitializationexception.html\">Hibernate LazyInitializationException 해결</a></p>","frontmatter":{"date":"November 10, 2020","title":"Review after the homework of a Startup - 어떤 스타트업의 과제 전형 참여 후기","categories":"개발","author":"개발한입","emoji":"💻"},"fields":{"slug":"/review-startup-homework/"}},"site":{"siteMetadata":{"siteUrl":"https://brewagebear.github.io","comments":{"utterances":{"repo":"brewagebear/blog-comments"}}}}},"pageContext":{"slug":"/fundamental-of-flutter-widget/","nextSlug":"/fundamentals-of-javascript/","prevSlug":"/review-startup-homework/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}